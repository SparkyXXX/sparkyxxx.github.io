## 问题

1. Net Classes，比如 PWR，怎么在原理图这边设置，不然每次从原理图更新 PCB，都会问我要不要 Remove PWR。类的作用主要是为了应用不同的规则对吗？每次都要取消勾选添加 add room 和 remove class？
2. 电源是否走过孔的问题：根据情况取舍，理论上讲过孔处的发热相对更多？以及有时不能分割地平面(作阻抗匹配的参考平面时)？对于电源平面的要求是尽可能整块整块的？信号线能不打孔就不打孔，电源能打孔就打孔；是因为打孔有阻抗突变，信号完整性受损？电源的过孔推荐打大一些，0.3-0.5 左右，可打密集阵列？
3. 为什么说 CMOS 芯片的背后不建议放元件？那其它的芯片，比如 MCU 后面能放嘛？
4. 视图选项卡中的板子规划模式用来干嘛的？
6. AD 的 xsignals 怎么用
7. 四种阻抗模式怎么选
8. 视频为什么是 10uF 和 100nF
9. 试一试四层板、分割平面、泪滴、曲线走线、扇出
10. 电阻电容电感值是怎么看的
11. 匹配BOM时，同一封装不同容值的电容，一定要自己手动编辑？
12. 电源芯片的推荐布局怎么看，怎么实现到电路板上
13. CMOS板子画好了怎么调

想给电源层画成不同的区域怎么办？

**优秀工程学习并搞懂原理**

**数据手册读懂**

## 问题和相关测试

[复刻目标的开源Hub](https://oshwhub.com/course-examples/usb-mo-kuai-3-0-ji-xian-qi)

有办法测板子上的电流嘛

加散热片和外壳

## USB3Hub

USB Hub又称USB集线器，它使用星型拓扑结构可扩展出多个USB接口。USB Hub的核芯是主控芯片（又称桥接芯片），通过软硬件算法将PC身上的某个USB接口（上游端口）资源分配给USB Hub扩展出来的USB接口（下游端口）使用。

理论上，USB Hub身上的多个下游端口们会平均分配上游端口的带宽，再加上USB Hub自身信号传输过程中也存在耗损，所以下游端口的总带宽一定小于上游端口分享的带宽。如今USB3.0闪存盘的实际读取速度多在100MB/s左右，折合带宽也不到1Gbps，所以哪怕USB Hub同时接驳了2～3个USB3.0闪存盘，其实际读写速度也不会出现明显的下降。

市面上的USB Hub，它们身上扩展出来的USB接口数量几乎都是4个、7个或者10个。因为市面上的Hub桥接芯片都是一拖四的，要想扩展更多USB，就只能同时使用更多桥接芯片。由此就会引发一个问题：“桥接芯片1”扩展出来的USB 1、USB 2和USB 3将平均分配上游端口3/4的带宽，而“桥接芯片2”旗下的USB 4、USB 5、USB 6、USB 7则共用剩余的1/4带宽。没错，USB接口带宽不一致，就是7口和10口USB Hub所面临的最大问题。因此很多7口USB Hub都采用了3个USB3.0和4个USB2.0接口的设计，恰好可以掩饰USB接口带宽不一致的尴尬。

当键盘和鼠标都连接在USBHub的接口上时，突然拔下键盘或鼠标会导致系统假死1秒～2秒左右，而这个问题则源于USB Hub的识别协议。简单来说，USBHub添加或删除设备时采用了枚举方式，而Windows系统中用于USB枚举设备的线程只有一个，因此当Hub上有设备插拔时，该Hub和其所连接USB设备的请求都会被挂起（出现卡顿假死），而挂起的时间与PC性能和Hub主控芯片的性能。

目前USB3.0 Hub的主控主要以VIA旗下的VL810/VL811/VL812，创维科技GL3520和瑞昱RTS5401等芯片为主，这些主控平时的性能差别不大，只是在同时接驳多款USB3.0闪存盘并进行同时读写时才能表现出差距。

![](https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250623233132028.png)

此外，通过高端主控还能赋予Hub更多的功能，比如东芝旗下的一款USB Hub工作站就能在接驳USB设备的同时还能连接HDMI和网线。

![](https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250623233151593.png)

如果你需要一款4口以上的USB Hub，或是平时需要用Hub连接移动硬盘，那就一定要选择自带外接电源的产品！USB2.0和USB3.0所能传输的最大电流值分别为500mA和900mA，而一款移动硬盘（HDD介质）则需要450mA～800mA（视不同型号） 的电流才能稳定驱动。换句话说，在USB2.0 Hub上接驳移动硬盘，移动硬盘运行起来会非常勉强；如果USB3.0 Hub在接驳移动电源时还连接着键盘鼠标，那移动硬盘同样面临着供电不足的隐患。问题来了，移动硬盘供电不稳极易引起硬件故障，导致硬盘和内部重要数据受损！因此，只要你觉得今后有用USB Hub连接移动硬盘的可能性，无论是USB2.0/3.0 Hub，都要选择配备外接电源的型号，弥补USB接口自身电力供应不足的缺陷。 

![](https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250623233402464.png)

USB2.0接口的标准供电参数为5V/500mA，即具备2.5W的输出功率。如果以2.5W为标准，4口USB Hub的电源功率最好可以达到10W，即配备一个5V/2A的外接电源才算及格。如果是7口USB Hub，只有当电源功率在18W以上才能满足所有接口的供电所需。因此，一些口碑较好的7口USB Hub大都会配备12V/2A或更大功率的外接电源（图9）。

![](https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250623233453236.png)

注意USB接口间距：考虑到很多闪存盘“膘肥体胖”，如果Hub上的USB接口太近，很容易出现设备间争抢地盘的现象。一般来说，18mm或更大的间距才靠谱

海备思旗下的一款配备连体旋转USB接口的Hub堪称绝配。这个Hub可以直接“贴合”在平板身上，没有了线缆的舒服，整洁且方便。如果你的超薄笔记本不仅USB接口少，还没有RJ45网线端口，则可购买自带RJ45接口的USB Hub。由于这类Hub需要借用1个USB桥接以太网，所以它们清一色都采用了3个USB＋1个RJ45接口的结构。如果你的超薄本没有读卡器，则可购买自带多合一读卡器的Hub。同理，这类产品也会因读卡器功能而失去一个USB，所以结构形态也多以3（USB）＋1（读卡器模块）结构

[USB标准](https://www.cnblogs.com/MinPage/p/14266892.html)

[USB Hub细节问题](https://www.cfan.com.cn/2016/0518/126197.shtml)

现在主流的USB 3.0设备都很难占满总带宽（5Gbps），比如主流的3.0 U盘大概只有100MB~200MB/s的传输速度，折合带宽也不到2Gbps

USB Hub的原理比较复杂，USB协议规范里最复杂的部分就是Hub的章节，USB Hub与网络设备（以太网）的Hub原理相差很多，如果真要类比的话，复杂度大概相当于网络的设备里的路由器。

　　USB协议中有控制传输、Bulk传输、中断传输、同步传输四种模式，其中：

　　控制传输用于传输控制设备一级的指令；

　　Bulk传输（中文名可能叫批传输）主要用于传输USB各种大块数据，比如U盘读写的数据；

　　中断传输，用于传输小块数据，鼠标键盘主要使用中断传输；

　　同步传输，用于传输实时性不够强的数据，也就是说不保证可靠性，部分USB音频设备使用这种传输；

USB Hub负责整合下游设备的各种传输信号，其中同步传输有一定限制，如果超过总带宽的某个比例（记忆中是20%），那么超出比例的同步传输将被丢弃；中断传输和控制传输占用的是保留带宽，不允许丢弃；Bulk传输占用剩下的带宽，如果没有同步传输，那么Bulk传输大概能占到90%以上的总带宽。USB Hub整合数据以后向上游设备发送，如果上游还有USB Hub，那么上游的设备还会继续做同样的操作。另外，需要说明的是，通常来说主机上的USB接口，本身就是一个Root Hub，如果一个PC上有多个接口，可能是多个接口共用一个控制器，每个控制器上有一个Root Hub。所以USB Hub相当于重新封装了各种数据包，类似于网络设备里的路由器，而不像交换机或者集线器（Hub）那么简单。同时USB Hub自身还是一个USB设备，负责向上级汇报自己的下级有多少个设备，它本身也要占用一些带宽周期性汇报自己的状态。由于以太网等很多网络（常见共享HUB连接的内部网）是基于总线方式，物理上是广播的，就是当一个机器发给另一个机器的数据，共享HUB先收到然后把它接收到的数据再发给其他的（来的那个口不发了）每一个口，所以在共享HUB下面同一网段的所有机器的网卡都能接收到数据。交换式HUB的内部单片程序能记住每个口的MAC地址，以后就该哪个机器接收就发往哪个口，而不是像共享HUB那样发给所有的口，所以交换HUB下只有该接收数据的机器的网卡能接收到数据，当然广播包还是发往所有口。显然共享HUB的工作模式使得两个机器传输数据的时候其他机器别的口也占用了，所以共享HUB决定了同一网段同一时间只能有两个机器进行数据通信，而交换HUB两个机器传输数据的时候别的口没有占用，所以别的口之间也可以同时传输。这就是共享HUB与交换HUB不同的两个地方，共享HUB是同一时间只能一个机器发数据并且所有机器都可以接收，只要不是广播数据交换HUB同一时间可以有对机器进行数据传输并且数据是私有的。

[USB Hub原理](https://cn.purplelec.com/info-detail/usb-hub-21)



芯片内部的数字地和模拟地要分开是因为芯片本身对电源的要求比较高

SPI 片选引脚的共享引脚，用于连接外部 flash

![image-20250529095848961](../assets/post-pics/image-20250529095848961.png)

TVS：瞬态抑制二极管，防止静电；选择反相截止大于等于 5V 的，接口正常工作是 5V，这样正常工作时 TVS 不工作。漏电流小。TVS 的原理？

电脑 USB3 的 type-c 接口一般输出 1A 左右的电流，如果 Hub 接的负载比较大，可能会损坏电脑接口，因此加限流保护芯片

## 跳转点

ldo没有太多噪声，逻辑门和运放也没有



还有是逆变和斩波的，因为原理就是会对

输入输出的大电流的要小心

先分析影响源

都当电阻看，电阻大小和长度有关

避免环地

星形接地最理想，也能实现比较好的效果，纯模拟

面积大好的原因是阻抗小

一个是走线的关系，大电流，交变，和芯片以及其他线路的关系

阻抗匹配

buck电感，

电源区域的问题

法拉第笼原理

多画

对电源的要求高，网口变压器
因为大的滤波电容和电感做不到芯片里面去，所以要引出VA，VD，AGND，DGND等，在外边儿处理

谁他妈叫你创新的，我真操了，他妈的芯片上就只有一组外界的接口，我真他妈服了我操。。。

type-c也是，不要想当然地认为它就是这么实现的

看看别人的机构，别人怎么画的

先布局、再按据阻抗匹配设置规则、完成层叠设计

连接杂线，跨越板子的线扇出，注意过孔更不要将参考平片割裂，晶振走内差分，芯片电源线向内扇出、然后走差分线，电源线加宽

电源分割：https://blog.csdn.net/Mark_md/article/details/116570283

宇哥的板子都是信号层，不用完整的内电层作阻抗匹配嘛

圆角走线和铺铜，shift + space切换

删除孤铜，铺铜时勾选即可

ui差分对布线

view config可隐藏铺铜

shift+s以及透明度调整可以观察铺铜后的情况

内电层的分割，PL放置线条

加泪滴te

圆弧走线

等长调节要放在发送侧

ur网络等长调节

差分线加过孔以及等长调节

调节丝印

差分走线的共面差分阻抗匹配和等长调节：先设置线宽确保和计算值一致，然后再预留过孔的情况下走线，然后等长调节，最后补过孔包地

最后加泪滴

元器件和走线和板框边缘要保持一定距离

DC-DC和晶振
