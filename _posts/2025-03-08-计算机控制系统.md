---
title: 计算机控制系统
description: 课程笔记
author: Hatrix
date: 2025-03-08 17:40:00 +0800
categories: [电子技术]
tags: [课程笔记]
math: true
mermaid: true
---

成绩构成：30%+70%(主观题+客观题)

## 第一章：概述

### 1.1 一般概念

CCS 概念：CCS 是应用计算机参与控制并借助一些辅助部件与被控对象相联系，以获得一定控制目的而构成的系统。

#### AD 和 DA 转换

AD 包含三种形式的转换：

- 模拟信号采样：按一定的时间间隔对连续信号进行采样，将其变为时间上断续的离散信号。(使得在时间上只能离散)

- 信号幅值的整量化：按照信号幅值按有限字长的最小量化单位分层取整，变为离散的信号。(使得在幅值上只能离散)

- 数字编码：已整量化的分层信号转换为等值的二进制数码信号，即数字信号。

DA 转换包含两种形式的转换：

- 数字解码：把数字量转换为等值的模拟脉冲信号。(使得在幅值上允许存在连续)

- 信号恢复：把解码之后的模拟脉冲信号变为随时间连续变化的信号(使得在时间上允许连续，恢复精度与 AD 时的采样周期有关，可以用零阶保持器实现)

#### 工作过程：实时

- 实时数据采集：对被控参数的瞬时值进行检测、转换并输入到计算机中。

- 实时决策：对实时的给定值和被控量的数值进行分析，并按已定的控制规律进行计算，以决定进一步的控制策略。

- 实时控制：根据决策，实时地对执行机构发出控制信号

这三个步骤所构成的循环周期就是实时时间，也称为采样周期 Ts。计算机控制系统的实时时间常由定时中断产生。实时的意思是信号的输入、计算和输出都是在一定时间范围内完成，要求计算机对输入信息以足够快的速度进行处理，并在一定的时间内作出反应或控制。只要延迟时间不错过控制的时机，便认为系统具有实时性。

实时需要考虑两个要素，一是根据被控过程出现的事件能保持多长时间；二是该事件要求计算机在多长的时间内必须做出反应。

系统的实时性指标取决于：检测仪表延时，过程输入(A/D)延时，计算机运算延时，数据传输(D/A)延时、执行机构延时等。

被控对象和计算机直接连接，并接受计算机控制的方式称为在线方式/联机方式，反之则称为离线方式或脱机方式。在线系统不一定是实时系统，但实现系统一定是在线的。

#### CCS 的特点

精度高、运算速度快、存储容量大、有逻辑判断功能，可以实现高级复杂的控制方法，获得快速精密的控制效果。

1. 计算机控制系统是混合信号系统
2. 系统包含多种信号形式
3. 计算机控制系统的分析和设计需要先进的理论支持
4. 能实现复杂的控制规律，且控制规律灵活多样
5. 计算机控制系统可分时控制多个回路，适应性强，灵活性高
6. 计算机控制系统使得控制与管理容易结合并实现更高层次的自动化，提高了企业自动化程度
7. 计算机控制系统能够比较方便地实现系统的自动检测和故障诊断，提供了系统的可靠性和容错、维修能力

### 1.2 CCS 组成

将检测装置、比较装置、控制器、放大器、执行环节和被控对象串联起来可以构成最简单的闭环控制系统框图。最重要的两个装置就是控制器和检测装置。将控制器用计算机来实现，并加入 AD、DA 就是 CCS

![image-20250224111125243](../assets/post-pics/image-20250224111125243.png)

#### 硬件组成

- 主机：由 CPU、内存储器及时钟电路组成，是控制系统的核心。
- 标准外部设备：按功能分为输入设备、输出设备、外存储器三类

- 过程通道/输入输出通道：按照模拟量/数字量，输入/输出分类，排列组合有四大类：

  - 模拟量输入通道(A/D 通道)：包括传感器、变送器、多路采样器、AD 转换器
  - 开关量输入通道(DI 通道)
  - 模拟量输出通道(D/A 通道)
  - 开关量输入通道(DO 通道)

- 接口：协调计算机与外设和过程通道的工作

- 人机联系设备/人机接口：要求具有容错性。

- 通信设备：完成不同位置、不同功能的计算机或设备间的信息交换

#### 软件组成

- 系统软件：包括操作系统、程序设计系统、通信网络软件和诊断系统等，具有一定的通用性
- 应用软件：包括控制算法程序、输入/输出接口程序、监控程序和信息管理程序等

### 1.3 CCS 结构形式

- 操作指导控制系统：数据采集并为操作人员反映生产过程工况的各种数据，并相应给出操作指导信息
- 直接数字控制系统：简称 DDC，通过 AD 和 DI 采集数据，经计算机处理后通过 DA 和 DO 直接控制生产过程
- 监督控制系统：简称 SCC，通常采用两级计算机，第一级位 DDC 完成直接数字控制的功能，第二级位 SCC，根据数据反馈和数学模型进行计算并向 DDC 提供控制信息
- 集散控制系统：简称 DCS，将控制系统分成若干个相对独立的子系统，通过通信网络联系子系统，实现大系统意义上的总体目标优化
- 现场总线控制系统：简称 FSC，结构模式为“操作站——现场总线智能仪表”两层结构。
- 综合自动化系统：由企业资源信息管理系统 ERP、生产执行系统 MES、生产过程控制系统 PCS 的三层结构组成

### 1.4 发展概况和发展趋势

略

## 第二章：通道接口技术

### 2.1 计算机对外围通道的控制

计算机对外围通道的控制，其基础是中断系统，具体则通过接口电路实现。计算机与内存及所有设备的连接都是基于三总线的，因此需要了解总线上的数据来自于哪个设备，同时也需要考虑计算机的控制量如何送入某台具体设备，这就是所谓的选址。

#### 输入输出接口的编址方式

外围通道的地址对 CPU 来说有两种编址方式：统一编址方式和独立编址方式，本课程讨论隔离 IO

- 存储器映像 I/O(又称统一编址方式)

  8088 上有$$\overline{MERQ}$$和$$\overline{IORQ}$$信号，用于选择 CPU 此时是与内存交互还是与外部设备交互；8086 上则将它们合并为$$IO/\overline{M}$$信号。图中的结构控制 0-7FFFH 为内存空间，8000H-FFFFH 为外部存储器空间，即外设是占用内存的。

  ![image-20250310133014075](../assets/post-pics/image-20250310133014075.png)

  ![image-20250416005032377](../assets/post-pics/image-20250416005032377.png)

  优点：

  - CPU 对外围的操作可使用全部的存储器操作指令，简化了指令系统的设计，不必单独包含 IO 操作指令
  - 内存和外设的地址分布图是同一个
  - IO 地址数几乎不受限制

  缺点：

  - 外设占用内存单元，使内存容量减小
  - 需要全字长的地址译码，需要使用更复杂的译码器芯片，指令操作的时间也有所延长
  - 程序中较难区分是否为 I/O 操作，程序可读性较差

- 隔离 IO(又称独立编址方式)

  需要专用的输入输出指令 IN/OUT 来访问外围端口，且仅限于对累加器进行操作，这增加了程序的复杂性，即必须将外部设备的数据送入累加器，再对累加器中的数据进行操作。

  ```assembly
  IN AL, n;  // 把外部数据送入AL寄存器中
  OUT n, AL; // 把AL中数据输出给外部设备
  ```

  隔离 IO 使用的是端口地址，且一个外部设备可能有多个寄存器，需要多个端口才能加以区分。

这种编址方式的优点是：

- 可读性好，指令与访问存储器的指令有明显区别，程序清晰
- IO 指令长度段，执行速度快，占用内存空间少
- IO 译码电路简单

这种编址方式的缺点是：

- CPU 的指令系统中必须有专门的 IN 和 OUT 指令
- IO 指令的功能没有访问存储器的指令功能强大

#### 直接寻址输入输出的时序

了解时序的目的是明白一条指令执行的过程中 CPU 为用户提供的信号，这些信号在时间上的配合关系，并要求接口电路设计选用的三态门电路和输出寄存器动作时序要和指令时序一致。

执行输入输出指令时，地址总线上为外部设备的端口地址，数据总线上为要传输的数据，控制总线上为选通 IO 操作时对应的电平。IN 指令时$$\overline{RD}$$信号有效，OUT 指令时$$\overline{WR}$$信号有效。

![image-20250402231948717](../assets/post-pics/image-20250402231948717.png)

第一个时钟周期内采样地址总线的变化，然后如果有需要输出的数据，此时就应该准备好；第二个时钟周期采样 IO 选通信号以及读或写信号(图中把读写都画成有效了，实际运行时只有一个为有效电平)；然后是可能插入的一个或多个等待周期，确保程序能准确运行；第三个时钟周期采样要读入的信数据

把从第一个周期的上升沿到下一个周期的上升沿称为输入输出周期，不同指令输入输出周期长短可能不同

#### 中断技术

中断的优点：避免 CPU 不断检测外设状态，提高 CPU 利用率，同时实现对特殊任务的实时响应

CPU 响应中断的四个条件：有中断申请信号、该中断申请未被屏蔽、软件代码中打开中断、CPU 在当前执行的指令结束后响应中断

中断响应的过程：向中断源发送$$\overline{INTA}$$信号表示中断已经得到响应，关中断，将 CS、IP、FLAGS 寄存器内容入栈以保护断点，获得中断服务程序首地址并处理中断服务程序，被保护内容出栈以恢复现场，开中断，返回主程序

#### 接口概述

接口的目的/必要性：

![image-20250402234125000](../assets/post-pics/image-20250402234125000.png)

常见的接口的类型包括：

- 并行 I/O 接口：CPU 内部总线是并行 IO
- AD 转换接口
- D/A 转换接口
- 实时时钟接口：距离较远的设备保持时间一致性
- DMA 控制接口：外设与内存之间直接的数据交换而不用通过 CPU，CPU 出让三总线控制权给 DMA 控制器，实现大批量数据传输，多用于操作指导控制系统，以及大量数据采集等场合
- 串行通讯接口：线数少、传输距离长、传输速率相对慢，串行通讯芯片有 8251
- 并行通讯接口：线数多、传输距离短、传输速率相对快，并行通讯芯片有 8255
- 网络通讯接口：集散控制系统、分布式控制系统中常用

#### 并行 IO 接口：无条件、查询、中断/选通

典型的外围并行接口由控制寄存器、状态寄存器、数据输入/输出寄存器：数据总线缓冲、地址总线缓冲、地址译码：中断控制器：联络信号控制逻辑等组成

![image-20250402234329388](../assets/post-pics/image-20250402234329388.png)

- 无条件传送(简单 IO 方式)：外设和 CPU 直接进行数据交互，只有在外部控制过程的各种动作时间是固定且已知的条件下才能使用，因此又称为同步方式。系统构成需要输入缓冲、输出锁存以及端口地址译码。使用条件为已知且确认外部设备已经准备好

  输入方式：CPU 执行 IN 指令时，外部设备的数据必须是准备好的

  输出方式：CPU 执行 OUT 指令时，必须确信所选外部设备的锁存器的数据已经被取走，否则新数据覆盖后就会造成数据丢失

  ![image-20250402235036820](../assets/post-pics/image-20250402235036820.png)

  无条件传送的特点是：CPU 需要与外设同步，CPU 效率较低。

- 查询传送：当系统控制时间不固定时，就需要加上握手信号，这称为查询传送，查询传送需要额外的两个数据，一是 CPU 的状态，二是外设的状态；以 OUT 指令为例，需要查询 CPU 是否已经准备好了数据，以及外设是否准备好了接收数据。接口部分除了数据端口外，还必须有状态端口。每次传输都需要询问 CPU 和外设是否响应握手信号，虽然能够保证数据传输的准确性，但浪费 CPU 时间，且实时性无法保证

- 中断传送：又称为选通 IO 方式，可提高 CPU 效率，在控制系统中很常见

  过程分析：Q 端和外设连接，将 Q 的状态传递给外设，当 Q=0 时说明上一个数据已经被取走。确认数据被取走后，外设向 D 触发器和锁存器发出时钟信号，申请 CPU 的中断。此时锁存器的输入传递到锁存器的输出，即三态缓冲器的输入；同时 D 触发器的 Q 端被置为高电平，当$$\overline{MI}$$(屏蔽信号)为高电平，即开启中断时，经过与门逻辑，INTR 信号有效，触发可屏蔽中断。当 CPU 同意处理中断后进入中断服务子程序中，开始执行 IN 指令，过程同无条件传送，此时或门输出低电平打开三态缓冲器，从外设来的数据进入数据总线；同时经过下面的与门触发 D 触发器清零，告诉外设数据已经被取走。

  当$$\overline{RESET}$$信号为低电平有效时，也可以进行异步清零。当存在多个外设时，除了有图中的状态寄存器(D 触发器)和地址寄存器外，还要有中断寄存器，每一位对应一个外设的中断情况，还要有中断屏蔽寄存器，每一位对应一个外设的中断是否被屏蔽

  ![image-20250402233548407](../assets/post-pics/image-20250402233548407.png)

  - 控制寄存器：存放从 CPU 送来的控制字，以指定接口电路要完成的工作，设定工作参数、工作方式等
  - 状态寄存器：保存通道的现行状态信息，以提供给 CPU 判断使用
  - 中断寄存器：存放$$Q$$和$$\overline{Q}$$的状态，包括中断申请寄存器和中断屏蔽寄存器

  另外，多个端口时还需要分配地址，有专门的端口地址和译码电路。

### 2.2 模拟量输出通道(DAC)

模拟量输出通道的任务是把计算机输出的数字量信号转换成模拟电压或电流信号，去驱动相应的执行机构，达到控制的目的。一般含有接口电路、电压/电流变换器、数模转换器，简称为 DAC。模拟量输出通道主要完成的是转换(DA，得到的是时间离散幅值连续的信号)和保持(把分段连续的脉冲信号转化为连续信号)两个任务。输出的物理信号有电压型和电流型，输出信号极性有单极性(只有正和零或负和零)和双极性，接受的数字量可以是并行方式和串行方式。

#### DA 转换原理

将输入数字量转换为与之成比例的模拟量，最常用的转换电路是 R-2R T 形电阻解码网络，由基准电压、运算放大器(将电流转换为电压)、权电阻网络和模拟开关组成，模拟开关由输入的数字量控制。

![image-20250311152751627](../assets/post-pics/image-20250311152751627.png)

$$
\begin{aligned}
\sum I_0&=\frac{-V_{ref}}{2R}\left(\frac{2^0}{2^n}D_0 + \frac{2^1}{2^n}D_1+\ldots+ \frac{2^{n - 1}}{2^n}D_{n - 1}\right)\\
U_0&=\frac{V_{ref}}{2R}\left(\frac{2^0}{2^n}D_0 + \frac{2^1}{2^n}D_1+\ldots+ \frac{2^{n - 1}}{2^n}D_{n - 1}\right)R_F\\
&=V_{ref}\left(\frac{2^0}{2^n}D_0 + \frac{2^1}{2^n}D_1+\ldots+ \frac{2^{n - 1}}{2^n}D_{n - 1}\right)\frac{R_F}{2R}
\end{aligned}
$$

对上述结构进行改进，得到反向 R-2R T 形电阻解码网络：基准电源的负载电流与二进制数码无关(负载电阻始终为 R)，提高了转换精度

![image-20250311154117248](../assets/post-pics/image-20250311154117248.png)

$$
U_{o}=\frac{R_{F}}{R}\cdot V_{ref}\sum_{i = 0}^{n - 1}\frac{D_{i}}{2^{n - i}}
$$

#### DA 技术参数

- 分辨率：$$\frac{V_{ref}}{2^n}$$，也可以说分辨率相当于输入二进制数最低有效位(LSB)相当的输出模拟电压。分辨率影响控制精度。

- 线性误差：在满刻度范围内，偏离理想转换特性的最大误差，用 LSB 的分数表示。

- 建立时间：输入二进制数变化量是满刻度(全 0 变全 1 或反之)时，输出达到最终值$$\pm \frac{1}{2}LSB$$时所需的时间

- 微分非线性：转移特性上任意两个连续码与理论值 LSB 之间的差距(理想的 DAC 任意两个数码之间的电压差为一个 LSB，但实际的 DAC 存在误差)，通常要求 DA 转换器的微分非线性误差小于$$\pm \frac{1}{2}LSB$$

- 单调性：输出电压随输入数码的增加而增加，要求特性斜率符号不变。

- 温度范围：较好的 DA 转换器工作温度范围在$$-40-85℃$$

- 输出电平：电流输出$$20mA-3A$$，电压输出$$5-10V$$、$$24-30V$$

- 温度系数：在满刻度输出的条件下，温度每升高 1℃ 时输出变化的百分数，单位是 ppmFSR℃，ppm 表示百万分之一，FSR 为输出电压满刻度

- 电源抑制比：是 DA 转换器受电源变化影响的指标，用电源变化 1V 时的输出误差相对满量程的比值来表示，单位是 ppm/V

- 其它的技术参数还有参考电压、接口方式、封装形式等

#### DAC 芯片

按输入带有缓冲寄存器的个数分为带 0 个(不带缓冲寄存器则必须外置缓冲寄存器)、1 个、2 个缓冲寄存器的(所有和 CPU 交互的设备都需要有缓冲寄存器，否则 CPU 所有出现在数据总线上的数据，不管是不是该设备应该接受的数据，都会被设别接收到)。DAC 芯片按集成电路形式可分为单端式、差动式和双向开关式，前两种采用双极型电路，只能使用单极性基准电源(因此 DA 输出也是单极性的)。双向开关式采用 CMOS 电路，可以使用正负基准电源。输出有电压型和电流型，输出电流型的如果想输出电压，外置运放即可。

#### DAC0832

![image-20250311163144144](../assets/post-pics/image-20250311163144144.png)
![image-20250311164026785](../assets/post-pics/image-20250311164026785.png)

整个结构分为 8 位 DA 转换器(R-2R 权电阻网络)，两个缓冲寄存器，以及控制信号输入。$$ILE$$为高电平有效的允许锁存信号，$$\overline{XFER}$$为低电平有效的传送控制信号，$$I_{out1}+I_{out2}=const$$，单极性输出时$$I_{out2}$$通常接地，$$I_{out1}$$输出电流大小与输入数字量成正比。两个地可以从总体上保证模拟地和数字地只在一点连接。

写信号线的时序如下，在标准 10V 电源输入下，写信号需要保持 500ns 脉宽；在 15V 电源输入下，写信号保持 100ns 脉宽就可以了

![image-20250311170208207](../assets/post-pics/image-20250311170208207.png)

五根控制线控制两个缓冲寄存器的工作模式：

- 直通：两个锁存器均不起作用，输入直接影响输出

  ![image-20250311172122334](../assets/post-pics/image-20250311172122334.png)

- 单缓冲：控制一个锁存器的工作(图中接法为控制输入寄存器)

  ![image-20250311172045553](../assets/post-pics/image-20250311172045553.png)

  ![image-20250311172146097](../assets/post-pics/image-20250311172146097.png)

- 双缓冲：两个写信号电平一致，而选通和控制传输信号同为 138 译码器的输出，不会同时有效，因此两个锁存器交替工作

  ![image-20250311194322778](../assets/post-pics/image-20250311194322778.png)

  下面的指令顺序，交换 34 的顺序，理论上不会影响转换结果，因为指令本质上就是控制一些高低电平的信号，对于 OUT PORT2, AL 而言，由于操作不涉及对芯片寄存器的操作，因此 AL 中的数据是什么并不影响，只要 DA 寄存器将输入送到输出即可。(但实际使用时，若交换则执行 OUT PORT2, AL 时存在竞争与冒险的问题，期望 DATA1 先锁存到 DA 寄存器中，然后 DATA2 锁存到输入寄存器中；实际上可能存在 DATA2 先锁存到第二寄存器直接覆盖 DATA1 的情况)

  ![image-20250311194532973](../assets/post-pics/image-20250311194532973.png)

  双缓冲的作用：一是可以使 DA 转换器在 DAC 寄存器锁存现有数据的同时，在输入寄存器中锁存下一个数据，可以按命令快速更新 DA 输出。二是双缓冲可以使多个 DA 转换器经由一个公共选通信号同时更新数据，先通过地址译码将数据分别送到多个芯片的输入寄存器中，用同一根线控制多个芯片的 DA 寄存器，便可以实现多个 DA 转换器同时更新数据。

#### DAC1208/DAC1230

![image-20250311200143692](../assets/post-pics/image-20250311200143692.png)

12 位的 DAC，电流稳定时间 1us，12 条数据输入线，对应为一个 8 位锁存器和 4 位锁存器，采用字节控制信号$$BYTE1/\overline{BYTE2}$$控制数据的输入，高电平时十二位数据同时存入第一级两个输入寄存器，低电平时只将低四位数据输入寄存器。1230 与 1208 的结构完全相同，区别只在于 1208 把 12 根数据线全部引出，为 24 引脚封装，1230 在内部将低四位连接到高八位中的高四位，只引出 8 根数据线，为 20 引脚封装。两者线性误差均$$< 1\text{LSB}$$

与 16 位微机相连(16 位微机表示数据总线宽度为 16 位)时，有直通、单缓冲和双缓冲三种方式，可选择接在高 12 位还是低 12 位，注意如果使用高 12 位，需要在传送前将数据移到高 12 位。与 CPU 的连接方式如图，其中电位器用于调整满量程时的输出电压(类似于调零的作用)，电容用于抑制因电流阶跃变化造成的输出过冲和振铃现象。与 8 位微机相连时，只能采用双缓冲方式，因为 8 位微机要转换 12 位数据，注定不能一次性传完数据，高八位和低四位必须异步工作。(注意左图为与 16 位微机的连接，右图为 8 位微机的连接)

![image-20250416093650815](../assets/post-pics/image-20250416093650815.png)

以该图为例，先执行 MOV AL, DATA1; OUT 00000101H, AL; 将高八位送入 8 位输入寄存器，再执行 MOV AL, DATA2; OUT 00000100H, AL; 将低四位送入 4 位输入寄存器并同时打开 12 位 DAC 寄存器。(注意 DATA2 的高四位而不是低四位进入 DAC)

#### 双极性模拟量输出

用偏移二进制码实现双极性输出(补码最高位/符号位取反就是偏移二进制码)的双极性输出，注意$$R_2$$与$$R_3$$的比值需要保证为 1:2，且$$V_{ref}$$要选用精密电源。另外，由于使用更大的电压范围来表示同样的数码，分辨率有所降低

![image-20250311213129470](../assets/post-pics/image-20250311213129470.png)

$$
\begin{aligned}
V_{OUT1}&=-\frac{\sum_{i = 0}^{7} 2^i D_i}{2^8}V_{ref}\\
V_{OUT2}&=-\left(\frac{R_3}{R_2}V_{OUT1}+\frac{R_3}{R_1}V_{ref}\right)=-(2V_{OUT1}+V_{ref})\\
&=\frac{2\sum_{i = 0}^{7} 2^i D_i}{2^8}V_{ref}-V_{ref}
\end{aligned}
$$

除了基于偏移二进制码的双极性输出，也可以实现按原码编码的双极性 DA 转换器，这种方式只适用于 CMOS 类的 DA 转换器。以偏移二进制码为例，输入给 DA 的数码需要已经转换为偏移二进制码，可以根据关系对应求原码(偏移二进制码最高位取反得补码，再减一得原码)。

#### 模拟量输出通道的结构形式

分为两类：

- 数字保持式(需要保持的是个数字量)：每个通道有独立的数据寄存器和 DA 转换器，先保持后转换，速度快，成本高

  ![image-20250311214020683](../assets/post-pics/image-20250311214020683.png)

- 模拟量保持式(需要保持的是个模拟量)： 多通道共用一个 DA 转换器，先转换后保持，速度慢，成本低

  ![image-20250311214259856](../assets/post-pics/image-20250311214259856.png)

#### 多路转换开关

也称多路模拟开关，多路转换器

1. 干簧管模拟开关——有触点开关

   - 开关的导通电阻接近于零，开路电阻大
   - 簧片刚性强，触头位移小，使用寿命长
   - 不受环境温度影响，漏电流为零
   - 切换速度低，维修量大
   - 适用于采样速度低的小信号低速高精度的检测系统

2. 集成多路开关——CMOS 工艺制作

   - 开关切换时间为短
   - 工作频率可达高
   - 体积小，使用寿命长
   - 导通电阻较大
   - 断开时有漏电流
   - 驱动部分和开关元件部分不独立，影响小信号测量的精度

   将多个传输门构成多路开关，特性是：电源电压越高，导通电阻越小，切换速度越快。而电源电压较高则需要相应的控制电平也高。导通电阻小，则传递精度会下降，希望提高精度则要求负载阻抗高，放大器和采样保持器可与开关直连。

   - CD4066——四双向模拟开关，可以按如图方式接成一个单刀双掷开关和一个双刀单掷开关

     ![image-20250312075127642](../assets/post-pics/image-20250312075127642.png)

   - CD4051——单端八通道模拟开关，其中逻辑电平转换部分完成 CMOS 到 TTL 的转换，S 为禁止端，目的是为了多个多路开关可以通过外部选通译码实现扩展

     ![image-20250413213530652](../assets/post-pics/image-20250413213530652.png)

   - CD4052——双端/差分四通道模拟开关，适用于差动输入信号

     ![image-20250312075914781](../assets/post-pics/image-20250312075914781.png)

   - CD4053——三个独立的单刀双掷开关(图中左侧四个模块为电平转换，中间三个模块为译码驱动)

     ![image-20250312080339754](../assets/post-pics/image-20250312080339754.png)

#### 采样/保持器

作用：在采样状态时，其输出能够跟随输入变化；在保持状态时，能使其输出值不变。

用途：(12 用于模拟量输入通道，34 用于模拟量输出通道)

1. 保特模拟量信号不变，以便完成 AD 转换
2. 同时采样几个模拟信号，以便进行数据处理和测量
3. 减少 D/A 转换器的输出“毛刺”
4. 把一个 D/A 转换器的输出分配到几个输出点，以保持输出电压的稳定性

工作原理：运放接成电压跟随器，开关闭合为采样状态，开关断开为保持状态，$$I_s$$为断开电阻漏电流，$$I_c$$为电容漏电流，$$I_i$$为运放输入电流，$$\Delta V$$为保持电压，$$T_H$$为保持时间。漏电流导致电容电荷衰减

![image-20250311215630068](../assets/post-pics/image-20250311215630068.png)

$$
\begin{aligned}
I_d&=I_c + I_i+I_s\\
\frac{dv}{dt}&=\frac{I_d}{C_H}\\
\Delta V&=\frac{I_d}{C_H}T_H
\end{aligned}
$$

采样/保持器中电容大小与采样频率以及要求的采样精度有关，采样频率越高要求电容越小，但下降速率越快，精度较差；采样频率较低时要求精度较高，可选用较大的电容。

采样保持器芯片的共同特点：采样速度快、精度高、输入阻抗高、保持电压下降速率慢等，保持电容外接

- AD582

  ![image-20250403155920677](../assets/post-pics/image-20250403155920677.png)

- LF398

  ![image-20250403155949638](../assets/post-pics/image-20250403155949638.png)

主要参数：

- 孔径时间：电路接到保持信号后，模拟开关由导通转变为断开所需的时间
- 捕捉时间：电路接到采样控制信号后，输出电压达到指定跟踪误差范围内所需的时间。A/D 转换器的采样周期应大于捕捉时间
- 保持时间：模拟开关 K 断开的时间，由采样速率确定
- 变化率$$\frac{\text{d}V}{\text{d}t}$$：反映在保持阶段，由于保特电容 C 漏电或放大器的漏电流所引起的保持电压的变化

#### DA 转换模板的设计

举例

![image-20250312101104372](../assets/post-pics/image-20250312101104372.png)

使用多通道共用一个 DA 的结构形式，DAC0832 接成直通方式，扫描开关为多路转换开关，且利用其开关与后面的运放构成采样保持器。

74LS93 为同步四位二进制可逆计数器，QA 对 QDQCQB 三位进行计数(2MHz 进行 64 分频后，周期为 32us，八个通道总共为 256us，且不占用 CPU 时间，CPU 时间只用于 IN 和 OUT 指令时对 2114 进行读写)，74LS157 内部为多个单刀双掷开关；2114 为 1k$$\times$$4 的 RAM 芯片，两个 2114 构成 1k$$\times$$8 的 RAM。用于存放八个通道需要转换的八个数据；74LS244 为锁存器(DA0832 内部有锁存器，此处外接锁存器是为了)；当$$\overline{IORQ}$$为无效电平时，B1B2B3 通过 74LS157，对 2114 进行选择，同时又对多路转换开关进行选择。以上部分电路对保持器进行刷新

上方的 74LS244 锁存器，一个负责将数据总线上的数据送入 2114，一个负责从 2114 中读出数据到数据总线上。DAC0832 接成直通方式，是为了更好地和 CPU 配合，实现读写操作(接成单缓冲或双缓冲则还要再加一层控制，更麻烦)。

当执行对应地址的 IN 或 OUT 指令时，$$\overline{IORQ}$$为有效电平，A1A2A3 通过 74LS157，对 2114 进行选择，同时使得 3 号 74LS244 锁存其输出，并禁止 CD4051，即多路转换开关全部不导通

![image-20250403160429044](../assets/post-pics/image-20250403160429044.png)

### 2.3 模拟量输入通道(ADC)

![image-20250403160606291](../assets/post-pics/image-20250403160606291.png)

ADC 的成本相对较高，往往使用多个通道共用一个 ADC 的结构，因此需要多路转换器；运放对选择后的微小信号进行放大

#### AD 转换原理

- 计数比较型 ADC：运放作为比较器控制计数器不断循环累加，直到比较器输出电平变化，计数器停止计数。特点是转换时间不固定，根据转换值的大小变化。

  ![image-20250403160816466](../assets/post-pics/image-20250403160816466.png)

- 双斜率积分式 ADC：先由输入电压对电容进行固定时间的充电，再由恒定的基准电压对电容进行放电，放电时间即对应转换结果。特点是中等转换速率，分辨率较高，且由于转换实际上是得到的一个平均值，故抗干扰性强。

  ![image-20250403160807141](../assets/post-pics/image-20250403160807141.png)

- 逐次逼近型 ADC：首先清除逐次逼近型寄存器，将最高位置 1，根据比较结果确定是否保留最高位的 1，后面的位重复这一过程直到完成转换(对分搜索)。特点是转换时间固定，中等转换速率，中等分辨率，由于始终在和输入模拟量进行比较，故需要保证输入的模拟量在转换过程中不变，这种形式的转换在实时控制系统中应用较多。

  ![image-20250403160759288](../assets/post-pics/image-20250403160759288.png)

- 并行 ADC/快速 ADC：同样是逐次逼近，但同时完成所有位的转换

  ![image-20250403160752346](../assets/post-pics/image-20250403160752346.png)

#### AD 技术参数

- 分辨率：基准电压与$$2^n$$的比值，表示引起输出从一个数码变化到下一个相邻数码的最小电压变化量
- 线性误差：实际转换曲线偏离理想曲线的大小，用 LSB 的分数表示。注意理想特性曲线是阶梯状的，且图中的曲线不从 0 开始，而是表示了四舍五入的过程。起始处称为零位误差，满量程时称为满度误差

  ![image-20250312170746636](../assets/post-pics/image-20250312170746636.png)

- 转换时间：完成一次 AD 转换所需的时间，即从 CPU 向 AD 发出启动转换信号开始，到得到稳定的数字量输出为止
- 转换率：单位时间的转换次数
- 对电源变化的敏感度：DC 电源变化 1%时，对应于一个输出位的输入电压变化的百分比，例如电源灵敏度为$$0.05\% /1\%U_d$$，表示电源变化量为$$U_d$$的$$1\%$$时，相当于引入$$0.05\%$$的模拟输入量。显然，敏感度越小越好。
- 温度环境方面：失调温度系数、增益温度系数

#### ADC 芯片

按输出代码有效位数分为 4 位、6 位、8 位、10 位、12 位、14 位、16 位，以及 BCD 码输出的$$3\frac{1}{2}$$位、$$4\frac{1}{2}$$位 、$$5\frac{1}{2}$$位等(读作几位半)(所谓半位，是指没有用到完整的一个数码，如 0000 到 1999 表示为 0 0000 0000 0000 到 1 1001 1001 1001)

ADC 选择原则：

1. 根据输入通道的总误差，确定 AD 转换器的位数：用户提供的数据采集精度要求是综合精度要求，应将综合精度在各个环节上进行分配，并注意 AD 转换器的精度应略高于其他环节所能达到的精度，据此确定 A/D 转换器的位数
2. 根据检测对象信号的变化率和转换精度要求，确定 AD 转换速率，以保证系统的实时性要求。比如双积分型的抗干扰和抗电源噪声能力强，精度高；但转换速度慢，常用于数字式仪表测量中。逐次逼近型的转换速率快，分辨率高，控制电路简单，应用最为广泛。全并行式等高速 ADC，适用于雷达、数字通讯等系统中
3. 根据环境条件选择 AD 转换器的一些环境参数要求，如工作温度，功耗，可靠性等级等
4. 根据计算机接口特征，考虑如何选择 AD 转换器的输出状态，如串行/并行、二进制码/BCD 码、与 TTL/CMOS 电路的兼容性、是否需要外部时钟、与微机接口是否易连接
5. 此外还需考虑成本、资源、是否为流行芯片等

#### ADC0809

单片 CMOS 器件，分辨率 8 位，转换时间由外部时钟芯片决定，内部不含时钟，线性误差$$\pm 1LSB$$(与之类似的 ADC0808 的线性误差为它的一半)，功耗 15mw，内部集成了 8 路输入模拟开关，28 脚双列直插封装，内置锁存器可直接与 8 位 CPU 接口，不需零点和满刻度调节，内部 ADC 为逐次逼近型

![image-20250403161128624](../assets/post-pics/image-20250403161128624.png)

芯片内部左侧为多路转换开关，右侧为标准的逐次逼近型 ADC。CBA 三个信号用于选择 8 路模拟开关中的哪一路进入 ADC；CLK 为时钟脉冲输入端，标准输入时钟为 640kHz，此时转换时间为 100us(500kHz 则为 128us)；START 信号的上升沿清除逐次逼近寄存器(SAR)，下降沿启动 AD 转换(即对逐位的置 1 和比较)；EOC 信号为高电平有效的转换结束信号；OE 为高电平有效的允许输出信号，接到内部的三态输出锁存缓冲器；有 8 根输出数据信号线。开关树和 256R 电阻梯形网络作为特殊形式的 DAC。第一个电阻为$$\frac{1}{2}R$$是为了舍入整量化。对于这种形式的 DAC，输出数据与位数有关，提高分辨率可有效减小输出误差。两位 DA 中的电阻网络如下

![image-20250403162301329](../assets/post-pics/image-20250403162301329.png)

时序：START 启动信号和 ALE 锁存信号要求持续时间长于 100ns，通道地址需要先于启动和锁存信号早 25-50ns，且需要保持 25-50ns，否则锁存的是不准确的地址；引入输入模拟信号到比较器给出第一个比较结果有 1-2.5us 的延时(由模拟开关自身带来的)，同时 EOC 由高电平变为低电平。转换结束 EOC 由低变高后 OE 有效，打开输出锁存器，然后数据总线上出现有效的 AD 转换结果。

![image-20250403162650588](../assets/post-pics/image-20250403162650588.png)

CPU 读取 AD 转换结果的方式有查询法、定时法、中断法，下面是查询法的子程序和接线图，其中上面蓝色为初始准备，黄色为启动转换，红色为查询转换，绿色为读取转换结果，末尾蓝色为一位转换结束后的处理。

![image-20250313085350998](../assets/post-pics/image-20250313085350998.png)

定时法，定的就是 AD 转换的时间，在硬件上只需将红色部分去除即可，软件上将红色部分改为延时 100us(640kHz 标准时钟输入下)即可。中断法则是 AD 转换结束后，在中断服务子程序中读取 AD 转换结果，EOC 直接接入 CPU 的$$\overline{INTR}$$上(如下图)(或类似于前面并行 IO 接口中的选通输入/输出方式中加上中断寄存器和屏蔽信号也可)。软件上第一次启动后，将绿色部分的读取转换结果和后面蓝色的后续处理放入中断服务子程序中，同时还要在中断服务子程序中启动下一次转换。直到转换结束，将 DX 重新赋值。

![image-20250416101405833](../assets/post-pics/image-20250416101405833.png)

ADC0809 是单极性输入，为了检测双极性的模拟量，需要在 ADC 输入端接入辅助电路。如果信号源内阻较小，具有一定的带载能力，使用左侧的无源网络，用电阻引入基准电压的偏移即可；如果信号源内阻较大时，可使用运放并接成电压跟随器进行阻抗匹配。无论使用哪种方式，注意两个偏移电阻的阻值要一致，一般用精密电阻。该方式使用的编码方式为偏移二进制码。

![image-20250403163406601](../assets/post-pics/image-20250403163406601.png)

#### AD1674

12 位 ADC 芯片，是 AD574、AD674 的改进，引脚完全相同(28 脚)，只是内部增加了采样保持器和精密电源且转换速度提高了。功耗 385mw，线性误差$$\pm \frac{1}{2}LSB$$，调高转换速度至 10us，分辨率 12 位，封装形式多为 SOIC(采用 BiMOS 工艺)，少有 DIP，内部无多路转换开关，可实现单路单极性或双极性输入，可以直接与 8 位或 16 位 CPU 连接(12 位输出在内部分为了 8 和 4，可以通过设置配置成不同的输出模式)

![image-20250403163450087](../assets/post-pics/image-20250403163450087.png)

$$20V_{IN}$$(0-20V 或-10-10V)和$$10V_{IN}$$(0-10V 或-5-5V)为电源输入端，两者同时只能有一个有效；REFIN 和 REFOFF 为参考电源的输入输出；BIPOFF 为单极性/双极性的控制(双极性偏移端)；10V ref 模块为精密电源，精度为百一；VEE 为工作电源$$\pm 12V$$或$$\pm 15V$$，$$V_{Logic}$$为控制逻辑电源 5V，AGND 和 DGNGD 为数字地和模拟地，$$\overline{STS}$$为转换结束信号；CE 为片选使能，要求脉宽大于 210ns，$$\overline{CS}$$为低电平有效的片选信号，$$R/\overline{C}$$为读/转换信号，其选择与 AD1674 的工作方式有关。AD1674 有全控制方式和独立控制方式，全控制方式需利用 AD1674 全部控制信号，高电平为读取转换结果，低电平为启动转换过程。独立控制方式则不需要有全总线的接口能力，在下降沿启动 AD 转换。$$12/\overline{8}$$为数据输出方式选择方式，高电平表示将 12 位数据一次性输出，低电平表示与$$A_0$$信号(字节信号，输入)配合，先输出 8 位再输出 4 位。且如果对分辨率要求不高，该芯片可以设置为 8 为 ADC，此时转换时间将比 10us 更短。 ADC 为逐次比较型，内部集成了 12 位高精度 DAC，含有逐次逼近寄存器(SAR)。芯片内部集成了采样保持器。

---

工作过程：启动信号，控制逻辑使采样保持器进入保持状态(因为接下来逐次逼近型 ADC 开始进行转换)，控制逻辑控制时钟，清除逐次逼近寄存器，转换周期开始(开始后不能中止或重新启动)，允许输出信号为无效电平；转换结束后，控制逻辑先把 SHA 置为采样状态，对 20V 或 10V 输入进行采样，同时使允许输出为有效电平，告诉 CPU 转换完成，同时打开三台输出锁存缓冲器，在数据总线上得到转换结果。

![image-20250313100213643](../assets/post-pics/image-20250313100213643.png)

两种控制方式中控制信号的作用

![image-20250403164511266](../assets/post-pics/image-20250403164511266.png)

---

全控制方式：

时序：启动信号和使能信号从无效变为有效电平可启动转换，读/转换信号需在启动信号和使能信号从无效变为有效电平之前 50ns 前变为低电平，准备进入转换状态，否则一旦启动和使能变为有效，仍在读状态，可能引起总线征用，引起误操作。启动时序中数据线由于输出锁存，全部处于高阻状态。读时序中，同样是读/转换信号需在启动信号和使能信号都变为有效电平之前变为低电平。注意进入读周期之后，数据出现在数据总线上的时间有 75ns 的滞后，另外当使能或片选信号失效后，数据还会在数据总线上保持 150ns。AD574、AD674 没有$$t_{HRR}$$(CE 为低后，读/转换保持高的时间)

![image-20250403164735538](../assets/post-pics/image-20250403164735538.png)

全控制方式下 AD1674 与 8 位 CPU 的连接：读写信号经与非门连接到使能端，地址总线经译码器连接到片选端；另外，8 位输出方式时，1674 有两个地址，偶地址传送高八位，奇地址传送低四位到八位中的高位，低四位为 0，拼接后为低四位为 0 的 16 位数据，处理时需要移位去除低四位

![image-20250403171120586](../assets/post-pics/image-20250403171120586.png)

独立控制方式：

时序：负脉冲控制中数据可用的时间为 800ns，四倍于正脉冲控制的 200ns，因此更加可靠和常用。

![image-20250313114839662](../assets/post-pics/image-20250313114839662.png)

独立控制方式下 AD1674 与 8 位 CPU 的连接：

![image-20250403171341533](../assets/post-pics/image-20250403171341533.png)

单极性和双极性输入：$$R_1$$用于零点调节，$$R_2$$用于满刻度调节，采用的编码方式为偏移二进制码(负的符号位为 0，正的符号位为 1)。这种实现双极性输入方式不会降低分辨率(1 个 LSB 代表的电压没变)。例如单极性时用 12 位表示 0-10V，双极性时用最高位表示符号位，用 11 位表示 0-5V 或-5V-0。

![image-20250313115228771](../assets/post-pics/image-20250313115228771.png)

AD1674 的精度较高，因此抗干扰的措施是必须的：

![image-20250313120809739](../assets/post-pics/image-20250313120809739.png)

#### 可编程数据放大器

数据放大器是一种高性能放大器，要求很宽范围的放大倍教，很小的零点漂移，很高的输入阻抗，很强的抑制共模干扰的能力。可编程数据放大器即要求放大倍数可由计算机程序改变放大倍数。

两种由分立元件构成的可编程放大器

- 用三个运放构成的 PA：广泛应用于小信号放大$$K = 1+\frac{2R_2}{R_{1i}}\quad(i = 0\sim7)$$，A1A2 两个运放构成差动输入差动输出放大器，差动增益越大越好，对共模信号没有抑制作用。A3 将差动信号转化为对地输出信号，该级的共模抑制比大。由于 CD4051 没有通道寄存器，因此与计算机连接时需要设置三位的数码寄存器。

  ![image-20250403173017745](../assets/post-pics/image-20250403173017745.png)

- 用采样保持器(图中为 AD582)构成的 PA：$$K = 1+\frac{R_2}{R_1}$$，$$R_1、R_2$$为采样保持器中的对应电阻。处于采样状态时将输出经过分压再引入负反馈就可以改变放大系数

  ![image-20250403173057031](../assets/post-pics/image-20250403173057031.png)

集成可编程序放大器 LH0086、LH0084

![image-20250313144449567](../assets/post-pics/image-20250313144449567.png)

#### 轴角数字传感器

将 0-360° 的轴角量转换为数字量

1. 用回转电位计+ADC 可实现轴角数字转换，将机械转角转为模拟电压，再经 ADC 转换为数字量。给电位计和 ADC 使用同一个参考电压，就可以匹配电位计的最大转角和 ADC 量程，适用于测量精度不高的场合。分辨率：$$\delta=\frac{V_{ref}}{2^N}\times\frac{\theta_{MAX}}{V_{ref}}=\frac{\theta_{MAX}}{2^N} $$

   ![image-20250403173651423](../assets/post-pics/image-20250403173651423.png)

2. 码盘是专用的轴角数字传感器，有接触式码盘、光电码盘和电磁式码盘，应用最多的是光电码盘，也称光电角位移传感器。特点是精度高、测量范围广、体积小、重量轻、使用可靠、易于维护。光电码盘根据刻度方法和信号输出形式分为增量式光电码盘和绝对值式光电码盘

   - 增量式光电码盘：码盘上分隔许多等间隔的间隙，只有一个刻有明暗光栅的码道，每转一圈产生固定的脉冲数。优点是易于实现小型化，响应迅速，结构简单；缺点是掉电后容易造成数据损失且有误差积累。有光通过时光敏二极管导通，输出低电平。码盘分辨率取决于码盘每转产生的脉冲数和码盘安装位置相对于被检测轴角的减速比。

     ![image-20250313151547965](../assets/post-pics/image-20250313151547965.png)

     $$
     \begin{aligned}
     n_m=\frac{N_c}{n}\times\frac{60}{t_1}\quad
     \begin{cases}
     n_m:&\text{每分钟转数}\\
     N_c:&\text{在}t_1\text{时间内所测得的脉冲数}\\
     n:&\text{码盘上的缝隙数}\\
     t_1:&\text{测速时间}
     \end{cases}
     \end{aligned}
     $$

     增量式码盘适合远距离传输，用长线驱动电路 75113 将 AB 脉冲变成互补的$$A、\overline{A}、B、\overline{B}$$脉冲进行传输；码盘输出信号接受端用 75115 再将$$A、\overline{A}、B、\overline{B}$$转换为 AB 脉冲。使用互补脉冲的目的是方便使用异或门电路进行断线检测。

     增量码盘在数控系统和机器人驱动系统中大量使用，原因是：

     - 测量精度高，理论上无限增加计数器的位数就可以得到无限的精度。对于角度检测还要求提高码盘到负载轴之间的传动比，总的前提是必须提高传动系统的传动精度，减小传动间隙。
     - 码盘直接安装在电动机轴上，是一种间接测量方案。传动系统的弹性变形，间隙等非线性因素被排除在系统闭环之外，闭环系统好调整，且机械结构设计简单。缺点是传动误差直接成为系统误差，在数控系统中常采用补偿的方法来提高精度。

     方向判别：在光栅两侧安装两对发光原件和检测元件，使其输出相位相差 90° 的两路脉冲，由相位的超前滞后关系来判断转向。Z 为用于测量绝对值的零位脉冲

     ![image-20250403233921837](../assets/post-pics/image-20250403233921837.png)

     绝对零位确定：有以下几种方式

     - 在机械零位安装行程开关，每次开机时驱动系统快速接近零位开关，碰到零位开关后系统低速运行，后用码盘的第一个 Z 脉冲给计数器清零便可获得准确的零位。
     - 在系统负载轴上安装电位计，用 AD 把轴的运动空间分成$$2^N$$个区间。每次开机系统在停止的位置开始转一圈产生一个 Z 脉冲，就可以确定负载空间的绝对坐标，读取时用这个绝对坐标加以修正就可获得绝对坐标值
     - 将增量式码盘设计成电子式绝对位置编码器，即在码盘内部的印制电路板上增加低功耗 CMOS 绝对位置计数器。系统启动后由计算机向码盘发出归零请求信号，借用码盘 AB 脉冲的信号线用串行通信形式将码盘记忆的绝对位置数发送给控制器。

   - 绝对值光电码盘：按二进制编码(对码盘安装精度要求较高，最严重的误差是，0000 由于安装偏差读成了 1111)或循环编码(解决 0000 和 1111 安装误差的问题，相邻数码之间只变化一位二进制位，也成为格雷码)刻制光栅，对应每一个转角能产生唯一的数码，有多少位输出就有多少个码道(图中内圈为高位外圈为低位)，尺寸比增量式码盘大；同时位数提高，内圈缝隙间隔将会变得非常密集，因此绝对式码盘位数一般不会太高，一般来说是 14-18 位，更高的位数可使用电子细分的方法或粗精结合(必须加以纠错)的方式实现

     格雷码译码时一般先转为二进制码，转换关系如下

     $$
     \begin{aligned}
     D_2D_1D_0为二进制码，&D_2'D_1'D_0'为循环码\\
     \begin{cases}
     D_2 = D_2'\\
     D_1 = D_2\oplus D_1'\\
     D_0 = D_1\oplus D_0'
     \end{cases}
     \end{aligned}
     $$

     绝对值光电码盘同增量式相比，优点有：具有固定零点，输出代码是轴角的单值函数；抗干扰能力强，掉电后再启动无需重新标定；无积累误差。缺点有：制造工艺复杂，不易实现小型化。

3. 感应同步器：电磁式位置检测元件，有直线式和旋转式，分别将直线位移或角位移转化为电信号。特点为：抗干扰性强、寿命长、维护方便、成本低、工艺性好、检测精度较高

4. 自整角机(旋转变压器)-数字转换器(SDC，RDC)

   利用自整角机(旋转变压器)将轴角转变成三相调制电压(正交两相调制电压)，然后用 SDC(RDC)转换成数字量。自整角机(旋转变压器)是同服系统常用的测角元件，使用 SDC(RDC)对其数字化，是对原伺服系统进行数字化改造常用的方法。

### 2.4 数字量输入/输出通道

#### 数字量输入通道

接受外部装置的状态信号并转化为计算机能接受的逻辑信号输入给计算机

结构：由输入缓冲器、输入调理电路、地址译码电路等构成

- 输入缓冲器：缓冲或选通外部输入，CPU 通过缓冲器读入外部数字量的状态，通常采用三态缓冲器
- 地址译码器：主要完成数字量输入通道的选通和关闭
- 输入调理电路：主要完成对现场开关信号的滤波、电平转换、隔离和整形等。

![image-20250404004518698](../assets/post-pics/image-20250404004518698.png)

输入信号的调理

将现成输入的状态信号经转换、保护、隔离、滤波措施转换成计算机能够接收的逻辑信号，处理掉瞬态尖峰电压、过电压、接触颤抖等现象。

1. 信号转换电路

   ![image-20250404004831174](../assets/post-pics/image-20250404004831174.png)

2. 滤波电路：以低通滤波为例

   ![image-20250404004853976](../assets/post-pics/image-20250404004853976.png)

3. 保护电路

   ![image-20250404004938502](../assets/post-pics/image-20250404004938502.png)

4. 消除触点抖动：双向消抖电路

   ![image-20250404005005732](../assets/post-pics/image-20250404005005732.png)

5. 信号的光电隔离：普遍使用光电耦合器，由发光器件和光敏接收器件组成

   输入电路的驱动方式

   ![image-20250404005332822](../assets/post-pics/image-20250404005332822.png)

   隔离开关量信号

   ![image-20250404005428104](../assets/post-pics/image-20250404005428104.png)

#### 数字量输出通道

将计算机输出的逻辑信号转化为外部设备的驱动信号

结构：由输出锁存器、光电耦合器、输出驱动器和地址译码电路组成

- 输出锁存器：锁存 CPU 输出的数据
- 光电耦合器：将 CPU 与驱动电路的强电及干扰信号隔离，使得计算机能安全、可靠地工作
- 输出驱动器：驱动继电器或执行机构的功率放大器。

![image-20250415223042647](../assets/post-pics/image-20250415223042647.png)

小功率驱动电路：驱动能力为 10-40mA，用于发光二极管、LED 显示器、小功率继电器等

![image-20250404005820149](../assets/post-pics/image-20250404005820149.png)

中功率驱动电路：驱动能力为 50-500mA，集电极电流可达 500mA，输出端耐压可达 100V，用于中功率继电器、电磁开关等，可采用达林顿复合晶体管或中功率晶体三极管驱动

![image-20250404010111072](../assets/post-pics/image-20250404010111072.png)

大功率驱动电路：采用固态继电器 SSR。SSR 是一种有源器件，其中两个低功耗输入控制端可与 TTL 及 CMOS 电平兼容，另外两个是晶闸管输出端。固态继电器分为单向直流型(DC SSR)和双向交流型(AC SSR)两种；双向交流型中又有过零触发型和调相型两种。输入电路和输出电路之间采用光电隔离，绝缘电压可达 2500V 以上，输出端有保护电路，负载能力强。固态继电器结构如下

![image-20250404010329374](../assets/post-pics/image-20250404010329374.png)

固态继电器驱动方法如下

![image-20250413230333859](../assets/post-pics/image-20250413230333859.png)

过零型固态继电器具有零电压开启、零电流关断的特点，输出端在控制信号有效并保持到过零时导通，控制信号消失后，在过零时关断。调相型固态继电器又称随机开启型固态继电器，具有快速开启功能，输出端随控制信号同步导通，控制信号消失后，过零时关断。

在功能在工程上，还有大量的其他驱动电路，如晶闸管驱动、大功率 MOSFET 驱动等。

## 第三章 系统总线

总线技术包括的内容有：通道控制功能、使用方法、仲裁方法、传输方式

### 3.1 总线的一般概念

总线就是连接两个以上数字系统元件的信息传输通路，芯片内部、电路插件板之间、系统中各插件板之间、系统与系统之间的连接都是通过总线进行的

#### 总线分类

![image-20250313162542306](../assets/post-pics/image-20250313162542306.png)

1. 片内总线：连接集成电路芯片内部各功能单元的信息通路

2. 元件级总线：插件板内部总线，限制在一块电路板内，实现板内元件的相互连接，是系统设计者在构成系统时必须考虑的一级总线。

3. 内总线/系统总线：插件板级总线，是电路板之间的连接，用于实现微型计算机的各插件电路板的相互连接。系统总线设计的合理性直接影响微机系统的工作效率。尽管总线的标准不同，但按功能看都可分为数据总线 D、地址总线 A、控制总线 C、电源总线 P

4. 外总线/通信总线：用于微型机系统之间或微型机系统与其它仪器或设备的相互连接。一般来说传输速率要相对低些，有并行方式和串行方式，常见的并行方式的总线标准有 IEEE488(GPIB)，为仪器仪表总线，方便构成自动化实验系统，常见仪器都配有这种总线接口。串行方式的总线标准有 RS-232、RS-422、RS-485、USB 等，RS-232、RS-422 和 USB 都是全双工，RS-485 为半双工。RS-232C 用波特率表示速率，是微型机系统标准配置的外总线，其传输速率和传输距离有限。

   现场总线是一种近年来发展很快的串行外总线，起源于汽车控制系统，是将自动化最底层的现场控制器和现场智能仪表设备互连的实时控制通讯网络。大都采用 RS485 接口，用双绞线进行传输，波特率可达 500Mb/s，传输距离最远可达 1.2km。

   各厂家有自己的通信协议，并且有各种现场控制模块：如模拟量输入、模拟量输出，开关量输入、开关量输出等。用户选用所需模块和控制计算机之间用双绞线串接起来，方便构成微机控制系统一现场总线控制系统。现场控制模块可直接将安装于现场，采集各种传感器的信号并发送给控制计算机，控制计算机将控制输出通过现场总线送到控制输出模块直接控制对象。

#### 总线的特性和性能标准

总线的特性可大致分为四个方面

物理特性：总线的物理连接方式，包括总线的线数、总线插头插座的形式、引脚排列形式和编号顺序等。

电气特性：总线中每一根线的信号传送方向、有效电平范围以及电气驱动能力

功能特性：总线中每一根线的作用，主要功能包括控制总线、数据总线和地址总线

时序特性：总线中每一根线在相对于主时钟信号的哪个时钟周期有效，即每根线的时序

总线的性能标准如下

![image-20250404111543161](../assets/post-pics/image-20250404111543161.png)

#### 总线标准

总线标准相当于提供了一个标准界面，作用是将总线两端的系统或模块解耦，一方在设计时参考标准即可，无需考虑另一端的接口形式。总线标准规定了机械特性，电气特性，功能特性，时间特性，总线性能。

常用的总线标准：

1. ISA 总线(Industrial Standard Architecture)：
   - 采用独立于 CPU 的总线时钟，因此 CPU 可采用比总线频率更高的时钟，有利于 CPU 性能的提高
   - 没有支持总线仲裁的硬件逻辑，因此不支持多台主设备系统
   - ISA 上的所有数据的传送必须通过 CPU 或 DMA 接口来处理，使 CPU 花费了大量时问来控制与外部设备交换数据。总体来说效率不高
   - ISA 总线时钟频率为 8MHz，最大传输速率为 16MB/s
2. EISA 总线：扩展 ISA 总线，是在 ISA 基础上扩充开放的总线标准，与 ISA 完全兼容
   - 从 CPU 中分离出了总线控制权，是一种智能化的总线
   - 支持多总线主控和猝发方式的传输
   - 总线的时钟频率为 8MHz，最大传输率可达 33MB/s，数据总线为 32 位，地址总线为 32 位，扩充 DMA 访问
3. VL-BUS 总线：是 VESA 组织提出的局部总线标准(在系统外，为两个以上模块提供的高速传输信息通道)
   - VL-BIS 是由 CPU 总线演化而来的，采用 CPU 的时钟频率达 33MHz，数据线为 32 位
   - 配有局部控制器，通过局部控制器的判断，将高速 IO 直接挂在 CPU 的总线上，实现 CPU 与高速外设之间的高速数据交换
4. PCI 总线(Peripheral Component Interconnect 外部设备互联总线)：由 Intel 公司提供的总线标准
   - 与 CPU 的时钟频率无关，自身采用 33MHz 总线时钟，数据线为 32 位，可扩到 64 位，数据传输率 132MB/s~246MB/s
   - 与 ISA、EISA 总线均兼容，可转换为标准的 ISA、EISA
   - 支持无限读写猝发方式，速度比直接使用 CPU 总线的局部总线快
   - 可视为 CPU 与外设间的一个中间层，通过 PCI 桥路(PCI 控制器)与 CPU 相连(因为 PCI 总线是一个局部总线)
   - PCI 控制器有多级缓冲，总线上的外设与 CPU 可并行工作
   - 为用户提供了真正的即插即用功能

#### 总线控制方法

![image-20250313172324695](../assets/post-pics/image-20250313172324695.png)

其中主控模块为 CPU/DMA，从属模块为存储器地址／IO 地址；读操作源模块为存储器／IO，目的模块为 CPU/DMA，反之同理。

#### 总线结构

有单总线结构和多总线结构，单总线结构的结构简单，传输效率低。本课程介绍的总线均为单总线结构，本章介绍的是总线类型中的内总线，也称系统总线。

#### 标准化总线的优点

标准化、模块化、系列化

1. 简化了硬软件的设计

2. 简化了系统结构

3. 系统易于扩展

4. 便于系统更新

5. 便于调试、便于维修

### 3.2 常见系统总线

#### STD 总线

STD 总线为 80 年代我国优选的工业控制机标准，结构简单且具有较好的兼容性，可以向上向下兼容；STD 总线有 8 条数据线 16 条地址线和控制、电源线等。通过周期窃取和总线复用技术由 8 位总线标准发展到可容纳 16 为处理器的 8 位/16 位兼容总线(16 条数据线，24 条地址线)，再发展到可容纳 32 为处理器的 32 位总线标准(32 条数据线，32 条地址线)

#### IBM PC/XT 总线

PC/XT 微机由一块多层 PCB 以及插在板上的 PC/XT 总线上的各种插件板卡构成，PC/XT 底板为 4 层电路板，表面两层传送各种信号，内两层分别为电源和地线，最右侧为 8 个 62 引脚的插件板插槽。

![image-20250404112122852](../assets/post-pics/image-20250404112122852.png)

48kROM 用于固化 BIOS，64kRAM 为 128kByte-256kByte，每个存储单元包括 8 位数据位 +1 位奇偶校验。系统板上总线行程由总线控制器 8288、地址信号锁存器、数据收发器以及一些其它信号产生电路构成 PC/XT 总线。

总线信号的定义：引脚分 A 面元件面和 B 面焊接面，两面各 31 引脚

![image-20250327091957626](../assets/post-pics/image-20250327091957626.png)

其中 AEN 为引脚 A11，是高电平有效的地址允许信号，用于切断 CPU 对总线的控制，允许总线上进行 DMA 传输。AEN 低电平时由 CPU 控制总线；AEN 高电平时由 DMA 接管总线并提供地址和读写等总线信号；因此在设计接口电路时该信号一定要参与地址译码。

#### IBM PC/AT 总线(ISA 总线)

PC/XT 总线为 8 位数据总线，传输速率不高，是比较简单的、功能不太强的总线；后来出现了 80286，即 PC/AT 微机，便用兼容的方式将原 8 位 PC/XT 总线扩展为 8 位和 16 位数据传输的工业标准，即 ISA 总线。AT 总线保留了 PC/XT 的全部 62 条引脚信号，同时在底板上增加了一个 36 引脚的插槽，中间的缺口为防呆设计。

![image-20250327092828805](../assets/post-pics/image-20250327092828805.png)

新增加信号如下：

- 高位地址线 A20-A23(引脚 C5-C2)使原来的字节寻址范围扩大到 16MB。D8-D15 为引脚 C11-C18，为高八位数据线。增加了 A17-A19 三条地址线(引脚 C8-C6)，这是不采用锁存的地址线，比有锁存的方式快些

- IRQ10-IRQ15(引脚 D3-D7)为中断请求输入，两片 8259A 级联，从中断控制器到主中断控制器的 IRQ2 上，这样原 PC/XT 的 IRQ2 在 AT 总线上变为 IRQ9，在级联中 IRQ8 为最高优先等级，接定时器 8254 用于产生定时时钟中断，IRQ13 指定给数据协处理器使用

- DRQ0，DRQ5-DRQ7 为 DMA 请求引脚 D9 对应 DRQ0，引脚 D11、D13、D15 分别对应 DRQ5、DRQ6、DRQ7。两级 DMA 控制器级联，主 DMA 控制器的 DRQ0 接从 DMA 控制器的请求信号 HRQ 这样就形成了 DRQ0 一 DRQ3、DRQ5 一 DRQ7，共 7 级 DMA 优先级。不再采用 DMA 实现动态存储器刷新，总线上的设备均可使用这 7 级 DMA 传送

  ![image-20250404113910436](../assets/post-pics/image-20250404113910436.png)

- SMEMR、SMEMW 对应引脚 C9、C10，为新定义的存储器读写信号，在整个 16M 字节范围内均有效；PC/XT 总线上的 MEMR 和 MEMW 信号只有在存储器的寻址范围小于 1M 字节时才有效
- I/OCS16，对应引脚 D2，为接口的 16 位片选信号，由接口地址产生，低电平有效，用于通知主板进行 16 位接口的数据传送，由三态门或集电极开路门输出，以便实现线与。16 位端口的读写每次读入或写出一个字，使用数据总线 D0-D15。

注意：

1. 16 位端口的读写只能在偶地址的端口上使用，不能在奇地址的端口上使用

2. 在进行 16 位端口读写时扩展槽上的总线信号 I/OCS16 需要一个低电平的脉冲，其正确时序应在 IOW、IOR 之前出现，而且要求采用三态门或集电极开路门驱动。必须将所有的 16 位端口的译码信号相与后经三态门驱动接到信号线 I/OCS16 上

   ![image-20250327100208732](../assets/post-pics/image-20250327100208732.png)

AT 机的 IO 地址分配如下

![image-20250327100310823](../assets/post-pics/image-20250327100310823.png)

需要保证接口板的地址没有被系统默认的端口占用

XT 和 AT 总线的可访问端口地址都是 64K，但只使用 1024 个地址的原因是，1024 个端口对用户来说一般够用；且从电路实现角度看，只使用 10 条地址线比使用 16 条地址线译码要容易且节省得多。当 16 位地址译码和读写地址高于 1024(3FFH)地址端口时，有两种情况：

- 若其低 10 位与系统板上或标准插板占用端口重合时，将会引起系统板和标准板误译码，这是不允许的。
- 若端口地址的低 10 位与系统板及标准插件板占用的端口地址均不重合，即在保留区域内时，该端口是可用的。在插件电路板中需要大量端口时，可以利用这种方法，一个保留的低十位地址结合高 6 位地址线构成 64 个端口，达到扩充端口数的目的

ISA 总线之后又有 MCA 总线(电气和物理上均与 ISA 不兼容)、EISA 总线(与 ISA 完全兼容且具有 MCA 功能，实现 32 位数据传送)

#### 工业 PC/IPC

由于 IBM PC 总线比 STD 总线有更多的优点，因此按工业机的要求将 PC 机改造为基于 ISA 总线的 IPC(工业 PC)。工业 PC 有如下特点：

- 全部采用板卡结构，包括 CPU 卡、视频卡、磁盘控制
- 输入输出工业控制接口均为模块化，便于安装和更换，便于计算机的升级换代
- 用专用的防震卡架将插板压紧，可以十分有效的保证插入的接口卡在震动的情况下接触良好

![image-20250327101256323](../assets/post-pics/image-20250327101256323.png)

#### 嵌入式工业控制机标准(PC/104 标准)

提供了 PC 总线在体系结构、硬件和软件的完全兼容性。采用结构紧凑的栈层叠接式模块(90\*96mm2)，适合嵌入式控制应用。PC/104 模块在电气和机版特性上与 AT 总线兼容的基础上采用非常小的体积(3.6×3.8×1.18 吋，即 90>×96×30mm3，独特的自层叠式结构。采用侧向插接的方式，纵向层叠将通常印制板的边缘插接改为接触可靠的插针插座结构，模块叠接后用支柱和螺钉连接固定。

另外，采用 CMOS 和搞集成度的元器件，低功耗的设计无需散热；绝大多数 PC/104 模块均采用单+5V 电源，从而降低了系统对电源的需求，也无需机壳和机箱。

被命名为 PC/104 是因为总线之间的互联用了 104 根信号线，分为一个 64 引脚连接器和一个 40 引脚连接器；PC/104 总线的时序严格按照 ISA 标准时序。核心模块包括 XT、AT，386、486、586 等；外围模块包括通信控制、磁盘控制、显示控制、网络控制、数据采集与控制。

PC/104 系统与 PC/AT 标准完全兼容，可以当作一个元件嵌入系统中，许多工业 PC 的 CPU 板上也带有 PC/104 的接口。PC/104 总线和 STD 总线，PC 总线是一种互补结构，固有特点是嵌入式。

#### PCI 总线

外围部件互联总线(Peripheral Component Interconnet)，是介于 CPU 芯片级总线和系统总线之间的一级总线，用于在高度集成的外设控制器器件、扩展板和处理器系统之间提供一种内部连接机制，PCI 总线标准是一整套的系统解决方案。

特点

- 高性能：提高硬盘性能、出色地配合影像、图形及各种高速外围设备的要求
- 线性猝发传输：支持线性猝发地传输模式，确保总线不断满载数据，极大地提高了传输效率
- 总线主控同步操作：有利于 PCI 性能改善
- 即插即用：实现了自动配置
- PCI 总线和 CPU 异步工作：用户可随以增添多种外设
- 兼容性强：与 ISA、EISA、MCA 完全兼容
- 低成本高效益

性能

![image-20250327105609726](../assets/post-pics/image-20250327105609726.png)

系统结构：

![image-20250327110216847](../assets/post-pics/image-20250327110216847.png)

![image-20250404120917955](../assets/post-pics/image-20250404120917955.png)

CPU、Cache、内存之间的数据传输通过微处理器系统总线进行，它的数据传输速率高于 PCI 总线。CPU、Cache、存储器子系统经过 Host-PCI 桥与 PCI 总线连接。所有的 PCI 设备和 CPU 总线连接时，都需要设计桥接器，其作用为：

- Host-PCI 桥提供了一个低延迟的访问通路，使 CPU 能够访问 PCI 设备，PCI 主设备也能够访问主存储器
- Host-PCI 桥提供了数据缓冲功能，使 CPU 与 PCI 总线上的设备并行工作而不必等待
- Host-PCI 桥接电路包含了“PCI 总线控制器”，有多个设备申请使用总线时，由它进行裁决和分配总线的使用权

Host-PCI 桥实现了 PCI 总线的全部驱动控制，它实际上是一个高速 I/0 协处理器，主要解决 I/0 设备同 CPU 的连接关系。

### 3.3 PC 总线模板举例

以 ISA 总线模板为例

#### 主要技术指标

![image-20250327110530164](../assets/post-pics/image-20250327110530164.png)

使用 CPU 指令进行触发称为内触发，使用外部设备如按键触发称为外触发。

#### 结构

![Snipaste_2025-04-13_16-10-17](../assets/post-pics/Snipaste_2025-04-13_16-10-17.png)

将完整原理图简化为以下模块，并分别展开介绍

![image-20250404140606857](../assets/post-pics/image-20250404140606857.png)

AD574 转换时间 25us，内部没有集成采样保持器，因此需要外接

- 总线缓冲与地址译码：方块为异或门，两个输入分别为地址线和开关控制的 01；74LS245 为双向数据缓冲电路，写操作时 1 脚为高电平，数据传输方向为 D->BD，数据送到板子上；读操作时为低电平，数据传输方向为 BD->D；(D 为 ISA 总线来的信号，即 CPU 提供的信号，BD 为板子上的信号线)。图中用 S 表示 1 脚，连接着与非门，和 P 点有关；模板选中的标志是 P 点位高电平。为了达到这一点，所有异或门的输出需要为高电平，否则就会将 P 点电平拉低。因此可以用开关来控制端口地址，实现模板地址的人工装定。

  模板选择电路由三片 74LS136 实现(内部为四个 OC 异或门)，模板端口占用 8 个端口地址(对应 A2-A0)，占用哪 8 个地址由 A9-A3 确定，分别对应七个开关；而 A10 和 A11 用于扩展通道数(注意扩展出的地址低十位是否和扩展板的通道相冲突)。AEN 为低电平，代表由 CPU 控制总线，参与译码(此处 AEN 为低电平异或门才输出高电平)。不妨设 K27\K26\K22 闭合，K25\K24\K23\K21 断开，这样模板占用 PC 机的有效地址为 310H-317H(这个低十位地址对应 PC 实验卡的 IO 地址)。A11=0，A10=1，这样芯片输出端对应通道选通地址为 710H-717H。

  ![image-20250404141615011](../assets/post-pics/image-20250404141615011.png)

  板内译码

  ![image-20250327113613460](../assets/post-pics/image-20250327113613460.png)

- 多路模拟输入的控制

  ![image-20250404143148553](../assets/post-pics/image-20250404143148553.png)

  AD7503 和 CD4051 的使用完全相同，只是可以传送的电压范围更大一些，$$\overline{EN}$$为禁止端。由 74LS175 实现用数据总线选择地址的功能，Q4 和 Q4 非实现两片芯片的级联。例如此处需要 CH10 的数据进行 AD 转换，BD3-BD0 的数据为 1010，端口地址 Y0 为 138 译码器的输出，此处对应 710H，则执行的指令为 OUT 710H, AL;其中 AL 的低四位需要为 1010。由于运放随放大倍数的不同，滞后时间不同，故需要在通道号选择后到启动 AD 转换之间加入延时时间。CA741 同 uA741。

- AD 转换与接口

  ![image-20250404144637984](../assets/post-pics/image-20250404144637984.png)

  AD574 与 AD1674 逻辑相同，只是转换速率慢些，且内部没有集成采样保持器，故外置 LF398 采样保持器。图中接法要求 574 完成 12 位的转换，和 8 位 CPU 连接需要经过两次转换输出，但 A0 接地需要一次性输出。此处的解决方案是用两片 74LS373 分别完成高八位和低八位的存储。QD(外部触发脉冲) 和 Y1(711)为与非门的两 0 个输入，任意一个可启动 AD 转换。OUT 711H, AL;启动 AD574 进行 AD 转换，AL 中的数据不重要。此处两个非的逻辑可以起到延时作用(要求数据送入和启动转化之间要有足够的延时)。STS 信号通知 CPU 开始转换，通过 125 输出到 BD7；转换期间为高电平，转换结束为低电平。LF398 控制两片 373 的转换。执行 IN AL, 712H;来读入 AD 转换结果的低四位，判断 AL 数据最高位 BD7(即 STS 信号)是否为有效电平，若有效则说明已经转换结束，低四位为有效数据，否则为无效数据。同理执行 IN AL, 713H;来读入高八位。RC 微分电路的作用是将 STS 信号的变化更快地分离提取出来。CPU 读取 AD 结果的三种形式(查询、中断、定时)，此处使用查询方式。

- 模拟量输出通道

  ![image-20250404150146786](../assets/post-pics/image-20250404150146786.png)

  用到两片 DAC1210(图中只画了一片)，但它们的连接方式和工作逻辑完全相同，只是一片连接 Y4Y5(714H)，另一片连接 Y6Y7(715H)。8 位 CPU 意味着必须分两次传入数据，DAC 需要工作在双缓冲模式。执行 OUT 714H, AL;打开 DAC1210 的八位锁存器。AL 中为要转换的高八位数字。S 端即总线缓冲与地址译码部分的 S 端，即 P 点。再执行 OUT 715H, AL;输出要转换的低四位数据。716H 和 717H 对应另一个 DA 通道。执行完四个端口地址的 OUT 指令后，两个要转换的 12 位数据送到两个 DA 通道的第一级输入缓冲寄存器中。执行 IN AL,713H;指令(710H-713H 中的任何个端口地址均可)使$$\overline{IOR}$$为有效电平，从而使得 S 信号为低电平，即$$\overline{WR_2}$$和$$\overline{XFER}$$为低电平，将所有数据送入第二级 DA 缓冲器并得到转换结果。结构中上侧电位器用于零点校正，下侧电位器用于满度校正。

## 第四章 数字 PID 控制器设计

当被控对象的精确数学模型难以建立，系统的参数经常发生变化时，控制理论的其他设计技术难以使用，系统控制器的结构和参数必须依靠经验和现场调试来确定，此时应用 PID 控制技术最为方便。PID 适用于线性时不变的低阶系统。

三种控制作用分别对系统的影响：比例代表了当前的信息，其纠正偏差的作用使控制过程反映迅速。积分代表了过去积累的信息，它能消除静差改善系统的静态特性。微分在信号变化时有超前控制的作用，代表了将来的信息。算法蕴涵了动态控制过程的过去、现在和将来的主要信息，而且其配制几乎最优。

### 4.1 数字 PID 控制器算法

位置式 PID 代表了控制量的全量输出，代表了执行器应该到达的绝对位置。而对于有的执行器比如步进电机，本身带有对过去所有时刻输入求和的功能，则适合用增量式 PID(相当于将求和放到执行机构中)，增量式由于不需要对过去所有时刻误差求和，故计算量较小。因此要根据具体的执行机构来选择对应的 PID 算法。将积分和微分离散化并用有限精度的计算机实现就是数字 PID 控制算法。由于数字信号相对于模拟信号始终是有信息丢失的，因此理论上讲模拟 PID 控制器的效果优于数字 PID 控制器。

模拟 PID 和数字 PID

$$
\begin{aligned}
u(t) &=K_{p}\left[e(t)+\frac{1}{T_{i}} \int_{0}^{t} e(t) d t+T_{d} \frac{d e(t)}{d t}\right]+u_{0}\\
&\int_{0}^{t} e(t) d t  \approx \sum_{i = 0}^{k} e_{i} T_{s} \quad \frac{d e(t)}{d t} \approx \frac{e(k)-e(k - 1)}{T_{s}}\\
u(k) &=K_{p}\left[e(k)+\frac{T_{s}}{T_{i}} \sum_{j = 0}^{k} e(j)+\frac{T_{d}}{T_{s}}[e(k)-e(k - 1)]\right]+u_{0}\\
&=K_{p} e(k)+K_{i} \sum_{i = 0}^{k} e_{i}+K_{d}[e(k)-e(k - 1)]+u_{0}\\
\end{aligned}
$$

位置式 PID 和增量式 PID

$$
\begin{aligned}
u(k) &=K_{p}\left[e(k)+\frac{T_{s}}{T_{i}} \sum_{j = 0}^{k} e(j)+\frac{T_{d}}{T_{s}}[e(k)-e(k - 1)]\right]+u_{0}\\
\Delta u(k) &=u(k)-u(k - 1)\\
&=K_{p}\left\{[e(k)-e(k - 1)]+\frac{T_{s}}{T_{i}} e(k)+\frac{T_{d}}{T_{s}}[e(k)-2e(k - 1)+e(k - 2)]\right\}\\
\end{aligned}
$$

位置式 PID 递推形式

$$
\begin{aligned}
u(k) &=u(k - 1)+\Delta u(k)\\
&=u(k - 1)+K_{p}\left\{[e(k)-e(k - 1)]+\frac{T_{s}}{T_{i}} e(k)+\frac{T_{d}}{T_{s}}[e(k)-2e(k - 1)+e(k - 2)]\right\}\\
\end{aligned}
$$

数字 PID 的工程实现，三个参数可以离线计算

$$
\begin{aligned}
u(k) &=u(k - 1)+K_{p}\left\{[e(k)-e(k - 1)]+\frac{T_{s}}{T_{i}} e(k)+\frac{T_{d}}{T_{s}}[e(k)-2e(k - 1)+e(k - 2)]\right\}\\
&=u(k - 1)+q_{0}e(k)+q_{1}e(k - 1)+q_{2}e(k - 2)\\
q_{0} &=K_{p}\left[1+\frac{T_{s}}{T_{i}}+\frac{T_{d}}{T_{s}}\right]\\
q_{1} &=-K_{p}\left[1 + 2\frac{T_{d}}{T_{s}}\right]\\
q_{2} &=K_{p}\frac{T_{d}}{T_{s}}\\
\end{aligned}
$$

计算延时优化方法如下，该方法不止可用于 PID 算法，而是一种普遍使用的延时优化方法

$$
\begin{aligned}
u(k) &=u(k - 1)+q_{0}e(k)+q_{1}e(k - 1)+q_{2}e(k - 2)\\
&=Q(k - 1)+q_{0}e(k)\\
Q(k) &=u(k)+q_{1}e(k)+q_{2}e(k - 1)
\end{aligned}
$$

![image-20250404182010086](../assets/post-pics/image-20250404182010086.png)

### 4.2 数字 PID 的改进算法

1. 饱和作用的抑制

   由于实际系统机械和物理上的限制，实际的控制输出 u 有最值限制，这个限制会由于积分控制率的存在导致超调变大和过渡过程时间变长，这被称为积分饱和现象。针对这个问题的常见改进方法如下

   1. 积分分离法：只在误差量小于一定阈值时进行积分，依据误差进行抑制

      $$
      \begin{aligned}
      u(k) &=K_{p}e(k)+K_{i} K_{l}\sum_{j = 0}^{k} e(j)+K_{d}[e(k)-e(k - 1)]+u_{0}\\
      K_{l} &=\begin{cases}1 & \text{当 }|e(k)|\leqslant \varepsilon\text{ 时} \\ 0 & \text{当 }|e(k)|>\varepsilon\text{ 时} \end{cases}
      \end{aligned}
      $$

      ![image-20250405002400674](../assets/post-pics/image-20250405002400674.png)

   2. 遇限削弱积分法：当控制进入饱和区后不进行累积只进行削弱积分，依据控制输出进行抑制

      ![image-20250405002347030](../assets/post-pics/image-20250405002347030.png)

   3. 积累补偿法：用于抑制增量式算法的饱和，由于增量式算法的求和体现在 u(k-1)项，即控制输出中，故限幅也针对控制输出进行。具体做法式，若计算出的控制量越界，则将多余的控制量存储在累加器中，当控制量脱离饱和区后，再全部或部分加到输出的控制增量上。需要注意补偿也是一种变相的求和，不能使补偿后的输出控制导致了饱和

   4. 变速积分法：偏差大时累加速度慢，偏差小时累加速度快，相当于是对积分分离式 PID 更精细的控制
      $$
      \begin{aligned}
      u(k) &=K_{\mathrm{p}} e(k)+K_l K_{\mathrm{i}} \sum_{j = 0}^{k} e(j)+K_{\mathrm{d}}[e(k)-e(k - 1)]\\
      K_l&=
      \begin{cases}
      0 & |e(k)|>A \\
      {[A - e(k)]/(B - A)} & B\leqslant |e(k)|\leqslant A \\
      1 & |e(k)|<B
      \end{cases}
      \end{aligned}
      $$

2. 干扰的抑制

   差分对噪声特别敏感，且越高阶的差分影响越大，因此干扰主要影响的是微分项

   对于作用时间较短的快速干扰，可剔除最值并连续多次采样求平均来滤除；对于一般的随机干扰，可进行滤波处理。一阶惯性滤波如下

   $$
   \overline{e}(k)=(1 - Q)\overline{e}(k - 1)+Qe(k)
   $$

3. 微分算法的改进

   微分算法改进的本质思想是引入一定的平滑滤波，来减小噪声和误差对微分项的影响。针对这个问题的常见改进方法如下

   1. 四点中心差分法

      将$$\frac{T_d}{T_s}$$选得比理想情况下稍小，用过去和现在四个采样时刻的偏差平均值作为基准。再用加权平均的方式近似构成微分项

      $$
      \begin{aligned}
      \overline{e}_{k} &=\frac{e_{k}+e_{k - 1}+e_{k - 2}+e_{k - 3}}{4}\\
      \frac{T_{d}\Delta\overline{e}_{k}}{T_{s}} &=\frac{T_{d}}{4}\left(\frac{e_{k}-\overline{e}_{k}}{1.5T_{s}}+\frac{e_{k - 1}-\overline{e}_{k}}{0.5T_{s}}+\frac{\overline{e}_{k}-e_{k - 2}}{0.5T_{s}}+\frac{\overline{e}_{k}-e_{k - 3}}{1.5T_{s}}\right)\\
      &=\frac{T_{d}}{6T_{s}}(e_{k}+3e_{k - 1}-3e_{k - 2}-e_{k - 3})\\
      \end{aligned}
      $$

      修正后的位置式 PID 和增量式 PID 如下

      $$
      \begin{aligned}
      u_{k} &=K_{p}\left[e_{k}+\frac{T_{s}}{T_{i}} \sum_{j = 0}^{k} e_{j}+\frac{T_{d}}{6T_{s}}(e_{k}+3e_{k - 1}-3e_{k - 2}-e_{k - 3})\right]+u_{0}\\
      \Delta u_{k} &=K_{p}\left[\frac{1}{6}(e_{k}+3e_{k - 1}-3e_{k - 2}-e_{k - 3})+\frac{T_{s}}{T_{i}}e_{k}+\frac{T_{d}}{6T_{s}}(e_{k}+2e_{k - 1}-6e_{k - 2}+2e_{k - 3}+e_{k - 4})\right]
      \end{aligned}
      $$

   2. 不完全微分法：由于实际系统不能实现理论上的微分，必然存在一定的延迟，再数学模型中相当于一阶惯性环节，将这部分纳入微分项一同考虑便称为不完全微分

      不完全微分的传递函数有多种形式差分方程如下

      $$
      \begin{aligned}
      \frac{U(s)}{E(s)} &=k_{p}\left[1+\frac{1}{T_{i}s}+\frac{T_{d}s}{1 + \frac{T_{d}}{k_{D}}s}\right]\\
      \frac{U(s)}{E(s)} &=k_{p}\frac{1}{1 + T_{f}s}\left[1+\frac{1}{T_{i}s}+T_{d}s\right]\\
      \frac{U(s)}{E(s)} &=k_{p}\frac{1 + T_{d}s}{1 + \frac{T_{d}}{k_{D}}s}\left[1+\frac{1}{T_{i}s}\right]\\
      &以第一种为例，\text{令}\frac{T_{d}}{k_{D}}+T_{s}=T \quad \frac{\frac{T_{d}}{k_{D}}}{T}=\alpha\\
      u_D(k) &= \alpha u_D(k-1) + \frac{K_pT_d}{T}[e(k) - e(k-1)]\\
      u(k) &=K_{p}\left[e(k)+\frac{T_{s}}{T_{i}} \sum_{j = 0}^{k} e(j)\right]+u_D(k)
      \end{aligned}
      $$

      不完全微分通过一阶惯性环节，将微分项的作用延续到后面几个采样周期，同时对高频干扰有一定的抑制作用

      ![image-20250405010412592](../assets/post-pics/image-20250405010412592.png)

      完全微分存在一些问题，一是控制输出可能超过执行机构或 DA 转换的上下限；二是执行机构的响应速度可能跟不上，无法在短时间内跟踪较大的微分输出；三是微分对高频信号具有放大作用，高频干扰容易引起执行机构的频繁动作，影响执行机构的使用寿命。

      持续时间与$$\alpha$$成正相关，$$k_D$$大$$\alpha$$小则持续时间短，反之亦然。

4. 给定量突变时对控制量进行阻尼

   一种方式是使用前置滤波器

   $$
   \begin{aligned}
   \overline{R}_{k}&=(1 - Q)\overline{R}_{k - 1}+QR_{k}\\
   Q&=1-\exp\left(-\frac{T_{0}}{T_{s}}\right)
   \end{aligned}
   $$

   ![image-20250405011020399](../assets/post-pics/image-20250405011020399.png)

   另一种方式是修改算法中对给定值变化敏感的项，如使比例项和微分项，或单独使微分项根据输出反馈进行控制而不是根据偏差进行控制，两种方式分别称为微分先行 PID 和比例先行 PID。微分先行 PID 相当于给误差项加了一阶惯性环节；比例先行 PID 相当于给误差环节增加了二阶惯性环节/振荡环节

   $$
   \begin{aligned}
   \Delta u_{k} &=K_{p}\left[e_{k}-e_{k - 1}+\frac{T_{s}}{T_{i}}e_{k}+\frac{T_{d}}{T_{s}}(-y_{k}+2y_{k - 1}-y_{k - 2})\right]\\
   \Delta u_{k} &=K_{p}\left[-y_{k}+y_{k - 1}+\frac{T_{s}}{T_{i}}e_{k}+\frac{T_{d}}{T_{s}}(-y_{k}+2y_{k - 1}-y_{k - 2})\right]
   \end{aligned}
   $$

   ![image-20250405011606773](../assets/post-pics/image-20250405011606773.png)

5. 其它 PID 算法

   1. BangBang-PID 复合控制：BangBang 控制是一种时间最优控制，又称快速控制法。在偏差较大时使用 BangBang 控制加快系统的响应速度，在偏差较小时使用 PID 控制提高系统的控制精度。

   2. 带死区的 PID：为了避免控制动作过于频繁，可以人为设计死区，死区内认为误差为零

      ![image-20250405012236300](../assets/post-pics/image-20250405012236300.png)

   3. 智能积分器，积分的相位滞后会降低系统稳定裕度，因此提出以下的非线性积分器，称为智能积分器。其中$$t_m$$为满足$$e(t_m)=0$$的时刻，$$t_n$$为满足$$e(t_n)=0$$的时刻
      $$
      u(t)=
      \begin{cases}
      0 & e(t)=0, t = t_{\mathrm{m}}\\
      \frac{1}{T_{\mathrm{i}}}\int_{t_{\mathrm{m}}}^{t}e(t)dt & ee'>0, t_{\mathrm{m}}<t<t_{\mathrm{n}}\\
      e(t_{\mathrm{n}})=\frac{1}{T_{\mathrm{i}}}\int_{t_{\mathrm{m}}}^{t_{\mathrm{n}}}e(t)dt & e'(t)=0, t = t_{\mathrm{n}}\\
      e(t_{\mathrm{n}}) & ee'<0, t>t_{\mathrm{n}}
      \end{cases}
      $$

### 4.3 数字 PID 参数选择

首先确定控制器结构，保证被控对象的稳定并尽可能消除静差

![image-20250405100811198](../assets/post-pics/image-20250405100811198.png)

对参数的要求包括：整个闭环是稳定的、对给定量的变化能迅速响应并平滑跟踪、超调量要小、在不同干扰作用下，系统应能保持在给定值、控制量不宜过大

1. 采样周期的选择：应考虑以下因素

   - 香农采样定理决定了上限$$T_s \leqslant \frac{\pi}{\omega_{max}}$$，实际系统中各种环节的延时决定了采样周期的下限
   - 为了获得较好的跟踪性能，采样频率应大于 5-10 倍的参考输入信号频率，伺服系统可由闭环带宽或时间响应的要求来考虑
   - 出于对抗扰性能的考虑，采样频率应大于 5-10 倍的主要扰动频率，使系统克服低频的主要扰动而忽略高频的随机干扰
   - 执行机构的响应速度有限，采样频率应与之适应，过高的采样频率无意义
   - AD 的精度有限，过短的采样周期会使得前后两次采样达不到 AD 的分辨率要求而转换结果没有变化，对控制也没有帮助
   - PID 算法中，过长的采样周期会使微分项失去意义，过短的采样周期会使积分项失去意义
   - 对于多回路控制系统，总采样周期应该大于个回路采样周期之和

   一些经验值

   ![image-20250405102734798](../assets/post-pics/image-20250405102734798.png)

2. 实验试凑法确定 PID 参数

   通过模拟或闭环运行观察系统的响应曲线，然后根据各参数对系统响应的大致影响，反复试凑参数，以达到满意的响应，从而确定 PID 控制参数。一般先比例后积分再微分

   ![image-20250405103057897](../assets/post-pics/image-20250405103057897.png)

3. 实验经验法确定 PID 参数

   - 扩充临界比例度法：闭环整定方法

     比例度$$\delta$$是指，当输入变化满量程的百分之几，就能使控制器输出改变整个有效范围，$$\delta$$与$$K_p$$成反比。

     预选择一个足够短的$$T_s$$，使系统工作在纯比例状态并逐渐增大比例系数，直至系统出现临界振荡，记录此时的临界振荡周期$$T_r$$和临界比例系数$$K_r$$，选择控制度、查表确定参数、并运行实际系统进行修正，控制度是控制效果的衡量，越小表示越接近理想模拟控制器的效果

     ![image-20250405103939929](../assets/post-pics/image-20250405103939929.png)

   - 扩充响应曲线法：开环整定方法

     断开数字控制器使系统工作在手动状态，将被控量调节至设定值附近，稳定后突然施加阶跃信号，记录阶跃响应曲线并确定其中的纯滞后时间$$\tau$$和等效惯性时间常数$$T_p$$以及比值$$k=\frac{T_p}{\tau}$$，查表确定参数并运行实际系统进行修正

     ![image-20250405104354817](../assets/post-pics/image-20250405104354817.png)

### 4.4 常用的 PID 控制系统

单回路控制系统和串级控制系统

![image-20250405104606207](../assets/post-pics/image-20250405104606207.png)

串级控制系统的控制方式包括异步采样控制和同步采样控制，异步采样控制即主回路采样控制周期是副回路采样控制周期的整数倍，同步采样控制周期即主副回路采样周期相同。

串级控制的主要优点：副过程所受到的干扰，当还未影响到被控量时，就得到副回路的控制。副回路中参数的变化，由副回路给予控制，对被控量的影响大为减弱。副回路的惯性由副回路给予调节，因而提高了整个系统的响应速度。

---

前馈-反馈控制系统

反馈控制系统是按偏差大小进行控制，控制器只能在出现偏差后才产生控制作用以补偿干扰对控制量的影响，无法将干扰克服在被控量出现偏差之前，即想要无偏差先要有偏差。而前馈控制是针对可测量的特定扰动或输入设计的，是不依赖偏差的开环控制。

![image-20250405110615230](../assets/post-pics/image-20250405110615230.png)

按扰动设计的前馈-反馈控制结构如下

![image-20250405110708165](../assets/post-pics/image-20250405110708165.png)

对于存在迟滞环节的系统，采用大迟滞补偿控制，采用微分先行和中间反馈的控制方案。在控制精度要求较高情况下可采用预估补偿法，即估计延迟时间并加入控制结构中一并考虑。

另外，计算机中对于延时的实现，除了 CALL DELAY 这种非常蠢的方式，还有如下方式，假设延时时间为采样周期的 N 倍，可以开一个长度为 N 的 FIFO 队列，如图方式输出即可

![image-20250405224523237](../assets/post-pics/image-20250405224523237.png)

## 第五章 数字控制器的连续设计方法

计算机控制系统是混合系统，从不同的地方断开系统回路，可将系统看作离散系统或连续系统，控制器分别对应有离散化设计方法和连续设计方法。DA 忽略模拟化的过程可以看作零阶保持器，AD 忽略量化特性可以看作采样开关。

![image-20250408171346556](../assets/post-pics/image-20250408171346556.png)

离散化方法是将被控对象和保持器组成的连续部分离散化，直接采用离散控制理论的方法进行分析和综合设计出满足控制指标的离散控制器 D(z)，由计算机实现。

连续化方法是忽略控制回路中所有的零阶保持器和采样器，在 s 域中按连续系统进行初步设计，求出连续控制器 D(s)，然后再通过某种近似，将连续控制器 D(s)变换成离散控制器 D(z)，由计算机实现。缺点是将连续控制器变换成离散控制器，会引起 z 平面的极点偏离所需的位置。

### 5.1 连续设计方法的条件

一是量化单位要小，二是要求相当短的采样周期。

量化单位过大相当于系统中引入了较大干扰。可通过增加 AD 转换的位数来将干扰限制在很小的程度。量化单位和 AD 位数与参考电压有关。

香农采样定理规定最低采样频率，只有采样角频率$$\omega_s \geqslant 2\omega_{max}$$时，连续信号才可由它的采样信号复现。数字控制系统中一般用零阶保持器实现信号的近似恢复。零阶保持器的传递函数和频率特性如下，可见零阶保持器有低通滤波特性，对信号有相位延迟作用。(10 倍采样频率时有约 18° 的相位滞后)

$$
\begin{aligned}
H_0(s) &= \frac{1 - e^{-T_s s}}{s}\\
H_0(j\omega) &= \frac{1 - e^{-T_s j\omega}}{j\omega} = T_s \frac{\sin\left(\frac{\omega T_s}{2}\right)}{\frac{\omega T_s}{2}} \angle - \frac{\omega T_s}{2}
\end{aligned}
$$

![image-20250408172544751](../assets/post-pics/image-20250408172544751.png)

### 5.2 连续化设计步骤

1. 设计连续控制器(校正装置$$D(s)$$)：根据被控对象的特性和要求的性能指标，采用频率法、根轨迹法等连续域方法设计出校正装置，其中零阶保持器的近似如下

   ![image-20250408185846424](../assets/post-pics/image-20250408185846424.png)

   $$
   \begin{aligned}
   \frac{1 - e^{-T_s s}}{s} &\approx \frac{T_s}{1 + \frac{sT_s}{2}}\\
   \frac{1 - e^{-T_s s}}{s} &\approx \frac{T_s}{1 + \frac{sT_s}{2} + \left(\frac{sT_s}{2}\right)^2}\\
   \end{aligned}
   $$

2. 将连续控制器离散化：根据系统的具体情况，选择不同的离散化方法，使得$$D(z)$$逼近$$D(s)$$的特性

3. 检验闭环系统性能：采用数学分析、数字仿真或混合仿真技术预估并检验系统性能，可考察脉冲响应特性、阶跃响应特性(超调量、振荡次数、上升时间、过渡过程时间等)、频率特性(通频带、增益裕度、相位裕度、闭环频率响应通频带、峰值等)、直流增益、零极点分布等。

   若检验结果达不到要求，改进设计可以依次从以下方面进行：

   - 重选合适的离散化方法
   - 提高采样频率
   - 修正$$D(s)$$的设计

4. 编制程序在计算机上实现$$D(z)$$

### 5.3 $$D(s)$$的离散化方法

从$$D(s)$$环节考虑，评价参数包括：零极点分布、环节的频率响应；从系统出发，评价参数包括：主导零极点、系统带宽或穿越频率、直流增益、增益裕度和相位裕度、超调量、闭环频率特性的峰值

#### 脉冲响应不变法

使离散后环节的脉冲响应等于连续环节脉冲响应的采样值，离散化公式为直接进行 z 变换，可证明这种方法变换后离散环节的脉冲响应等于连续环节脉冲响应的采样

$$
D(z) = Z[D(s)]
$$

映射关系为$$z = e^{sT_s}$$，s 平面的虚轴映射为 Z 平面单位圆，s 左半平面映射在单位圆内，s 右半平面映射在单位圆外， 但这种方法的映射是重叠映射，因此存在频率混叠现象(想要得到同一个采样结果，采样方式并不唯一)。可在采样器前串联低通滤波器来衰减高频分量，或使用足够高的采样频率。

![image-20250408191449448](../assets/post-pics/image-20250408191449448.png)

特点

- 没有串联性质，即$$Z[D_1(s) \cdot D_2(s)] \neq Z[D_1(s)] \cdot Z[D_2(s)]$$
- 若$$D(s)$$稳定，则$$D(z)$$一定稳定
- 由于映射的多值性，只适用于被控对象本身高频特性衰减很好的低通或带通滤波器的离散化

#### 阶跃响应不变法

使离散后环节的阶跃响应等于连续环节阶跃响应的采样值，离散化公式为带零阶保持器的 z 变换，可证明这种方法变换后离散环节的阶跃响应等于阶跃环节脉冲响应的采样

$$
D(z) \equiv Z\left[\frac{1 - e^{-T_s s}}{s} D(s)\right] = (1 - z^{-1})Z\left[\frac{D(s)}{s}\right]
$$

对于频率响应，由于零阶保持器的引进相当于串接了一个低通滤波器，使高频分量有所衰减，频率混叠现象比 z 变换法有所减轻。

特点：

- 若$$D(s)$$稳定，则$$D(z)$$一定稳定
- 频率混叠现象比 z 变换法显著减轻
- 能保持稳态增益不变，即$$\left.D(s)\right|_{s = 0} = \left.D(z)\right|_{z = 1}$$

#### 差分变换法

用一阶差分代替微分，物理意义是以矩形面积代替积分

$$
\begin{aligned}
后向差分: D(z) &\equiv \left.D(s)\right|_{s = \frac{1 - z^{-1}}{T_s}} \quad \left.\frac{de(t)}{dt}\right|_{t = kT_s}\approx\frac{e(k)-e(k - 1)}{T_s}\\
前向差分: D(z) &\equiv \left.D(s)\right|_{s = \frac{z - 1}{T_s}} \quad  \left.\frac{de(t)}{dt}\right|_{t = kT_s}\approx\frac{e(k + 1)-e(k)}{T_s}\\
\end{aligned}
$$

![image-20250408193148259](../assets/post-pics/image-20250408193148259.png)

后向差分法映射及特点

![image-20250408193319651](../assets/post-pics/image-20250408193319651.png)

- 置换公式简单，应用方便，精度不高
- 映射压缩严重，因此畸变较大
- 若$$D(s)$$稳定，则$$D(z)$$一定稳定

前向差分法映射及特点

![image-20250408193456170](../assets/post-pics/image-20250408193456170.png)

- 置换公式简单，应用方便，精度不高
- s 左半面只有一部分映射到单位圆内，故近似精度差
- 若$$D(s)$$稳定，则$$D(z)$$不一定稳定

#### 双线性变换法/Tustin 法

相当于数值积分中的梯形法则

![image-20250408193739989](../assets/post-pics/image-20250408193739989.png)

$$
u(k) = u(k - 1) + \frac{T_s}{2}[e(k) + e(k - 1)]
$$

推导可得变换关系

$$
\begin{aligned}
s &= \frac{2}{T_s} \frac{z - 1}{z + 1} = \frac{2}{T_s} \frac{1 - z^{-1}}{1 + z^{-1}}\\
z &= \frac{1 + \frac{T_s}{2} s}{1 - \frac{T_s}{2} s}
\end{aligned}
$$

按照此法将$$D(s)$$离散化为$$D(z)$$

$$
\begin{aligned}
D(s) &= \frac{B_0 + B_1 s + B_2 s^2 + \cdots + B_m s^m}{A_0 + A_1 s + A_2 s^2 + \cdots + A_n s^n}\\
D(z) &= \frac{B_0 + B_1 \left(\frac{2}{T_s} \frac{1 - z^{-1}}{1 + z^{-1}}\right) + B_2 \left(\frac{2}{T_s} \frac{1 - z^{-1}}{1 + z^{-1}}\right)^2 + \cdots + B_m \left(\frac{2}{T_s} \frac{1 - z^{-1}}{1 + z^{-1}}\right)^m}{A_0 + A_1 \left(\frac{2}{T_s} \frac{1 - z^{-1}}{1 + z^{-1}}\right) + A_2 \left(\frac{2}{T_s} \frac{1 - z^{-1}}{1 + z^{-1}}\right)^2 + \cdots + A_n \left(\frac{2}{T_s} \frac{1 - z^{-1}}{1 + z^{-1}}\right)^n}
\end{aligned}
$$

双线性映射为一一映射

![image-20250408194304455](../assets/post-pics/image-20250408194304455.png)

特点：

- 无论$$D(s)$$分子阶次和分母阶次如何，变换后$$D(z)$$的分子分母必定同阶。这是因为连续环节中分母比分子高$$p=n-m$$次时，经过双线性变换后会体现在$$(1+z^{-1})^p$$因子上。事实上表示将 s 域无穷远频率处的响应映射到 z 域$$\nu = \frac{\nu_s}{2}$$频率点，即将无穷远处的零点映射到$$z=-1$$处
- 能保持稳态增益不变，即$$\left.D(s)\right\vert _{s = 0} = \left.D(z)\right \vert _{z = 1}$$
- 具有串联特性，即若$$D(s) = D_1(s) \cdot D_2(s) \cdots$$，则$$Tu[D(s)] = Tu[D_1(s)] \cdot Tu[D_2(s)] \cdots$$

设连续域频率为$$\omega$$，离散域频率为$$\nu$$，根据双线性变化的公式可得

$$
\omega = \frac{2}{T_s} \tan \frac{vT_s}{2}
$$

![image-20250408195055182](../assets/post-pics/image-20250408195055182.png)

由此可见，双线性变换的低频段坐标可看作近似线性关系，而高频段则产生较大畸变，且周期越小线性段越宽。相当于以高频特性的畸变来换取低频特性的等效性

#### 频率预畸变的双线性变换

为保证$$D(s)$$与$$D(z)$$良好的等效性能，使两者在特征频率处响应相等，步骤如下

- 将变换后的零极点替代原有零极点：$$s + a \Rightarrow \left.s + a^* \right \vert _{a^*=\frac{2}{T_s}\tan\frac{aT_s}{2}}$$
- 将$$D(s, a^*)$$变换成$$D(z, a)$$：$$D(z,a)=D(s,a^*)\ \vert _{s = \frac{2}{T_s}\frac{1 - z^{-1}}{1 + z^{-1}}}$$
- 增益调整

#### 零极点对应法/匹配 z 变换法

$$
\begin{aligned}
D(z)&\equiv D(s)\Bigg|_{s + a = 1 - z^{-1}e^{-aT_s}} \\
(s + a + jb)(s + a - jb)&=1 - 2z^{-1}e^{-aT_s}\cos(bT_s)+e^{-2aT_s}z^{-2}
\end{aligned}
$$

特点

- 同一个$$D(s)$$用零极点对应法和脉冲响应不变法得到的$$D(z)$$极点相同而零点不同

- 会将无穷远处的零点映射到$$z=-1$$

- 需要进行增益匹配

  对于具有低通滤波特性的$$D(s)$$，可采用直流增益不变的方法进行匹配，即$$\left.D(s)\right \vert _{s = 0} = \left.D(z)\right\vert _{z = 1}$$。若$$s=0$$时$$D(s) = 0 / \infty$$，则可选择某一临界频率$$\omega_1$$使$$D(s)$$和$$D(z)$$在$$\omega_1$$处幅值相等，即$$\vert D(j\omega_1)\vert =\left\vert D(e^{j\omega_1T_s})\right\vert $$

- 若$$D(s)$$稳定，则$$D(z)$$一定稳定

### 5.4 离散化方法总结

1. 就控制器本身性能而言，我们希望 D(z)和 D(s)的频率响应充分逼近
   - 双线性变换法(包括频率预畸变)和零极点匹配法等效性能一般都较好，尤其在采样频率较低时，比其他方法适应性强。
   - 差分变换法和带零阶保持器的 z 变换法在采样频率较高时也可以用。
   - z 变换法只适用于离散低通滤波器，如果 D(s)的高频特性不衰减，则无论采样频率取多高，也无法消除频率混叠现象，这时 z 变换法不能用。
   - 采样频率对离散化性能影响很大，采样频率增加，离散后性能显著变好
2. 就计算机控制系统闭环性能而言，不仅要考虑 D(z)和 D(s)的等效性能，还应考虑系统的通频带范围及零阶保持器相位滞后的影响

## 第六章 数字控制器的离散设计方法

连续化设计的缺点是，系统动态性能与采样频率的选择关系较大。而相应的，离散化方法是将被控对象和保持器组成的连续部分离散化，直接采用离散控制理论的方法进行分析和综合设计出满足控制指标的离散控制器 D(z)，由计算机实现。

### 6.1 解析设计法 / 最小拍系统

设计准则：数字控制系统在典型的时间域输入信号的作用下(例如阶跃输入，速度输入，加速度输入等)，经过有限个采样周期，输出信号的稳态误差为零，且在尽可能少的有限个数目的采样周期，稳态误差为零。

基本出发点：根据系统的性能指标要求，确定出闭环脉冲传递函数的形式，然后，通过代数解法，求出数字控制器的传递函数。

#### 系统框图分析

![image-20250409132550130](../assets/post-pics/image-20250409132550130.png)

$$
\begin{aligned}
G(z)&=Z\left[\frac{1 - e^{-T_ss}}{s}G(s)\right] \quad 广义对象的脉冲传函\\
\Phi(z)&=\frac{Y(z)}{R(z)}=\frac{D(z)G(z)}{1 + D(z)G(z)} \quad 闭环传函\\
D(z)&=\frac{1}{G(z)}\cdot\frac{\Phi(z)}{1 - \Phi(z)} \quad 数字控制器\\
\end{aligned}
$$

#### 有纹波最小拍系统设计

最小拍即在典型输入作用下，经过最少个采样周期，使系统的输出量在采样时刻跟踪上系统的输入量。

闭环传函的确定：根据下表，由典型输入选择误差脉冲传函$$\Phi_e(z)$$，使得$$E(z)$$展开式为有限项。注意，此表为最小相位系统的设计方式，即被控对象没有纯延迟环节和不稳定零极点。

$$
\begin{aligned}
E(z)&=\sum_{k = 0}^{\infty}e(kT)z^{-k}=e(0)+e(T_s)z^{-1}+\cdots+e(jT_s)z^{-j}+\cdots \\
E(z)&=R(z)-Y(z)=R(z)[1 - \Phi(z)]=\frac{R(z)}{1 + D(z)G(z)}=R(z)\Phi_e(z) \\
\frac{E(z)}{R(z)}&=1 - \Phi(z)=\Phi_e(z)
\end{aligned}
$$

![image-20250409133331995](../assets/post-pics/image-20250409133331995.png)

实际物理系统的分子阶次小于等于分母阶次，小于时存在$$z^{-1}$$的纯滞后特性。由于实际系统的不稳定零极点是由于噪声和系统参数变化而波动的，故不允许直接用$$D(z)$$取对消$$G(z)$$的不稳定零极点，否则会得到不稳定的控制器。因此$$\Phi(z)$$包含$$G(z)$$的不稳定零点(单位圆外或单位圆上)和纯滞后环节，$$1-\Phi(z)$$包含$$G(z)$$不稳定极点(单位圆外或单位圆上)，其物理含义是，数字控制器的串联校正作用不可能使对象提前动作，而只能改善系统的动态性能。

$$
\begin{aligned}
G(z)&=k\frac{z^{-l}(1 + a_1z^{-1}+a_2z^{-2}+\cdots)}{1 + b_1z^{-1}+b_2z^{-2}+\cdots} \\
D(z)&=\frac{1}{G(z)}\cdot\frac{\Phi(z)}{1 - \Phi(z)} \\
\Phi(z)&=\frac{D(z)\cdot G(z)}{1 + D(z)\cdot G(z)} \\
\end{aligned}
$$

总结第一个表格和此处数字控制器物理可实现的条件得到下表，给出了$$\Phi(z)$$设计需要满足的最低阶次条件，其中$$m$$与输入信号有关，$$l$$为$$G(z)$$的纯滞后幂次，$$z_i$$和$$p_i$$为$$G(z)$$的零极点

![image-20250409134952033](../assets/post-pics/image-20250409134952033.png)

另外，被控对象的不稳定零极点越多、纯滞后时间越长，调节时间也就越长。

#### 无纹波最小拍系统设计

按有纹波最小拍系统系统设计，得到的输出只在采样时刻跟踪了给定输入，在整个时间轴上看则在给定输入附近波动(或通过扩展 z 变换也可得出$$T_s + \Delta T$$时刻，误差并不为零)，究其原因，是$$u(kT_s)$$本身存在波动，过渡过程较长。而无纹波最小拍系统设计的原则，就是使得$$u(kT_s)$$的过渡过程在有限拍结束(注意这并不代表$$U(z)$$为有限项，$$u(kT_s)$$可以在某一拍之后保持恒定值输出，但并不一定恒为零)

类比：若希望输出过渡过程在有限拍结束，则需要以$$Y(z)$$为输出的闭环传递函数为有限项，即$$\Phi(z)$$极点均在 z 平面的原点。因此，若希望控制量的过渡过程也在有限拍结束，则需要以$$U(z)$$为输出的闭环传递函数为有限项

$$
\begin{aligned}
\Phi(z)&=\frac{Y(z)}{R(z)}=a_0 + a_1z^{-1}+\cdots+a_kz^{-k}=\frac{F(z)}{z^k}\\
\Phi_u(z)&=\frac{U(z)}{R(z)}=\frac{D(z)}{1 + D(z)G(z)}=\frac{\Phi(z)}{G(z)}
=\frac{\Phi(z)G_D(z)}{G_N(z)}
\end{aligned}
$$

由此可见，无纹波最小拍系统设计中，除了满足上个表格中的条件，$$\Phi(z)$$还需要包含被控对象的全部零点

![image-20250409142212418](../assets/post-pics/image-20250409142212418.png)

比较有纹波设计和无纹波设计可见：为使系统输出无波纹，是以增加调节时间为代价的。无纹波系统的控制信号$$u(kT_s)$$两拍后过渡过程就结束，而有纹波系统的控制信号$$u(kT_s)$$不停地振荡，过渡过程迟迟不能结束。

![image-20250409144009158](../assets/post-pics/image-20250409144009158.png)

#### 最小拍系统改进设计

最小拍系统本身是按照输入信号设计的，因此当输入信号改变，控制性能会急剧下降。具体来说，若最小拍系统按低阶典型输入信号设计，则在高阶典型输入下就会出现稳态误差；若按高阶典型输入信号设计，则在低阶典型输入下就会出现很大的超调量。

另外，最小拍系统也存在应用局限性

- 对不同输入类型的适应性差
- 对被控对象参数变化过于敏感：最小拍设计是在被控对象参数不变的条件下得到的理想结果。因此当被控对象参数发生变化时，系统响应将严重偏离期望状态
- 控制作用易超出限制范围：最小拍设计对控制量未作限制，所得结果是在控制量不受限制时系统输出稳定地跟踪输入所需要的最小拍过程

改进方式：引入加权因子 / 惯性因子，降低了对输入信号的敏感性，对不同的输入信号都有一定的适应性，是根据最小拍思想设计的控制器，但本身不是最小拍系统

$$
\begin{aligned}
1 - \Phi^*(z)&=\frac{1 - \Phi(z)}{1 - \alpha z^{-1}} \\
\Phi^*(z)&=\frac{\Phi(z)-\alpha z^{-1}}{1 - \alpha z^{-1}} \quad -1 < \alpha < 1
\end{aligned}
$$

采样周期的限制：采样周期越短则控制器输出越大，这会使系统立即工作于非线性饱和状态，从而使性能显著变坏。系统的响应快，也必然会使运动部件具有较高的速度和加速度，它将承受过大的离心载荷和惯性载荷，若超过强度极限就会遭到破坏。

### 6.2 频率响应设计法

连续域和离散域的频率是不同的，若要将连续域中频率设计的方法应用到离散域，需要进行一定变换，因此引入 w 变换

#### w 变换

w 变换是一种双线性变换，下面的式子由于变换后 w'平面与 s 平面更接近，因此一般用下面的 w'变换，后面的讨论也基于下面的式子进行

$$
\begin{aligned}
w=\frac{z - 1}{z + 1} \quad\Leftrightarrow\quad& z=\frac{1 + w}{1 - w}\\
w'=\frac{2}{T_s}\frac{z - 1}{z + 1} \quad\Leftrightarrow\quad& z=\frac{1 + \frac{T_s}{2}w'}{1 - \frac{T_s}{2}w'}
\end{aligned}
$$

若采样周期无限小，复变量$$w'$$近似等于复变量$$s$$

$$
\begin{aligned}
\lim_{T_s \to 0} w'&=\left.\lim_{T_s \to 0}\frac{2}{T_s}\frac{z - 1}{z + 1}\right|_{z = e^{sT_s}}=\lim_{T_s \to 0}\frac{2}{T_s}\frac{e^{sT_s}-1}{e^{sT_s}+1} = s
\end{aligned}
$$

两者在传递函数上也是相似的，其中$$T_s$$越小两者越接近

$$
\begin{aligned}
G(s)&=\frac{a}{s + a}\\
G(z)&=Z\left[\frac{1 - e^{-sT_s}}{s}G(s)\right]=\frac{1 - e^{-aT_s}}{z - e^{-aT_s}}\\
G(w')&=G(z)\Bigg|_{z=\frac{1 + \frac{T_s}{2}w'}{1 - \frac{T_s}{2}w'}}=A\cdot\frac{1 - \frac{T_s}{2}w'}{w' + A}\\
A&=\frac{2}{T_s}\cdot\frac{1 - e^{-aT_s}}{1 + e^{-aT_s}}\\
\lim_{T_s \to 0}G(w')&=\frac{a}{w + a}
\end{aligned}
$$

其中$$w'=\frac{2}{T_s}$$的零点是由于用零阶保持器恢复数字信号而引进的，它在右半平面，是非最小相位零点，反映了零阶保持器的相位滞后特性。令$$w'=j\nu$$，绘制频率特性如下

![image-20250409200923332](../assets/post-pics/image-20250409200923332.png)

从$$s$$平面到$$w'$$平面的映射关系如下，将$$s$$平面内频率范围$$-\frac{\omega_s}{2} \leqslant \omega \leqslant \frac{\omega_s}{2}$$的特性映射到$$w'$$平面$$-\infty \leqslant \nu' \leqslant \infty$$的范围，响应产生的范围从连续域的无限区间压缩到离散域的有限区间。$$s$$平面的一切分析和设计方法均适用于$$w'$$平面分析，但超过$$-\frac{\omega_s}{2} \leqslant \omega \leqslant \frac{\omega_s}{2}$$基本带的频率在$$w'$$平面无法分析

![image-20250409201148425](../assets/post-pics/image-20250409201148425.png)

三个平面的频率对应关系如下

$$
\begin{aligned}
\left.\begin{matrix}
s = j\Omega \\
z = e^{j\omega T_s}
\end{matrix}\right\} \Rightarrow z = e^{sT_s} \Rightarrow \Omega = \omega\\
\left.\begin{matrix}
w' = j\nu \\
z = e^{j\omega T_s}
\end{matrix}\right\} \Rightarrow w' = \frac{2}{T_s}\frac{z - 1}{z + 1} \Rightarrow \nu = \frac{2}{T_s}\tan\frac{\omega' T_s}{2}
\end{aligned}
$$

#### 频率法设计步骤

- 求被控对象的广义脉冲传函$$G(z)$$
- 将$$G(z)$$变换到$$w'$$平面上得到$$G(w')$$
- 在$$w'$$平面上设计校正装置$$D(w')$$
- 将校正装置$$D(w')$$变换到$$z$$平面上得到$$D(z)$$
- 检验数字系统闭环品质
- 编程实现$$D(z)$$

## 第八章 电磁兼容性设计

干扰即有用信号以外的噪声或造成计算机设备不能正常工作的破坏因素，影响计算机系统的可靠性和稳定性。造成干扰的原因有：控制系统现场，被控对象和被测信号分布的地点不同。计算机与它们之间的距离相当长，信号线和控制线均可能是长线。现场有许多强电设备，它们的启动和工作过程将对计算机产生强烈的干扰，如大功率电机或其它电气设备产生的磁场、高压电气设备产生的电场、各种电磁波辐射等。

### 8.1 电磁兼容性概述

电磁兼容性，简称 EMC，指一个设备或系统在其设置的预定场所投入实际运行时，应具有既不受周围电磁环境影响，又不影响周围环境，也不发生性能恶化和误动作，而按设计要求正常工作的能力，即设备或系统在电磁环境中的适应能力。

外部干扰由外界因素决定，与系统结构无关，空间电磁的影响包括输电线和电气设备发出的电磁场、通信广播发射的无线电波、太阳或其它天体辐射出的电磁波、带电物体的放电现象等。内部干扰由系统结构和制造工艺等决定，包括分布电容、分布电感引起的耦合感应、电磁场辐射感应、长线传输造成的波反射、多点接地造成的电位差、寄生振荡、热噪声、闪变噪声、尖峰噪声等。

电磁干扰产生的三要素/干扰形成的条件：干扰源(产生电磁干扰的发射体)、耦合通道(传递电磁干扰的途径)、受干扰体(承受电磁干扰的接收体)。相应的抗干扰措施为抑制干扰源、切断或衰减电磁干扰的传播途径、提高装置和系统的抗干扰能力。

电磁兼容性评价原则：噪声发送量$$\times$$耦合因素$$<$$噪声敏感度(各种电子或电气设备允许承担噪声的最高极限值)。电磁干扰经干扰源产生后，经导线传播的称为传导干扰，经空间传播的称为辐射干扰。

### 8.2 噪声源

分为自然噪声源和人为噪声源。自然噪声源即电子部件的热噪声和空中雷电，影响是影响电子设备提高灵敏度和性能的主要原因，很难在发生源上进行控制和抑制，种类基本未变。人为噪声源即电路内的无用耦合，汽车点火塞火花等，随电子设备和系统的增加与普及相应增加，种类繁多。

- 汽车发动机点火系统发出的电脉冲噪声
- 电弧焊机在高频引弧时会产生强度很大的干扰信号
- 用晶闸管对工频交流电对直流电动机进行导通延时相位控制来调速时也会产生干扰(去除此噪声应停止相位控制，采用电压过零时触发，改为工频半个周期为单位的通断控制，通过改变通断时间来进行连续控制)
- 无线电收发装置的通断会影响调节仪表等低电平输入电路的正常工作
- 日光灯的镇流器、启辉器以及灯管中的辉光放电
- 直流电机和带有换向器的交流电机中，由于整流子和碳刷的摩擦以及换流时产生的火花，通过导线传导出来再从导线辐射导低电平电路，对低电平电路造成干扰
- 直流继电器、交流继电器、电磁阀等电感性元件，在绕组导通和断开时会产生很高的反向电压，使得控制开关产生强烈火花放电，会烧坏开关触点并干扰低电平电路
- 高频加热炉、大功率变压器和电抗器产生的交变磁场，对邻近低电平电路和变压器产生磁耦合，从而使得这些电路和变压器受到干扰，
- 磨擦电效应：当电缆中的介质不与导体保持接触时，介质由于磨擦可以带电，这叫磨擦电效应。它往往是由于电缆机械弯曲而引起的，这种电缆的带电即成为噪声源，为此要防止电缆急剧地弯曲并防止电缆活动
- 电化作用：低电平电路的信号通路之间使用不同金属时，由于两种金属之间的电化作用，也会产生噪声。
- 导线的运动：当一段导线在磁场中运动时，线的两端就会产生电压。由于到处都有电源线或大电流配线，因此在大多数地方都有杂散磁场，若个工作于低电平的导线在磁场中运动，导线上就会产生噪声。这个问题在振动环境中特别严重应将电缆固定起来

### 8.3 噪声抑制技术

#### 屏蔽

处于噪声和受噪声影响的电路及设备之间，能阻断噪声影响的金属导体称为屏蔽

![image-20250412123259812](../assets/post-pics/image-20250412123259812.png)

- 静电屏蔽：导线之间由电场引起的静电耦合等效电路如下

  ![image-20250412123506035](../assets/post-pics/image-20250412123506035.png)

  $$
  V_2 = \frac{C_{12}}{C_{12}+C_{20}}\cdot V_1
  $$

  可用金属制成相应的屏蔽层进行隔离，切断耦合电容，有的导线内会包裹屏蔽层，一端接地

  ![image-20250412123853768](../assets/post-pics/image-20250412123853768.png)

- 电磁屏蔽：导线之间由于电磁感应引起的电磁耦合模型如下，电磁感应带来的效果为，电流流经回路 1 时相当于在回路 2 接入相应的电压源

  ![image-20250412124126382](../assets/post-pics/image-20250412124126382.png)

  $$
  \begin{aligned}
  V_2 &= j\omega AB\cos\alpha\\
  V_2 &= j\omega MI_1
  \end{aligned}
  $$

  一是可以拉开两回路的空间距离以减小交链磁通减小$$B$$值，二是可以缩小回路 2 的面积$$A$$，三是可以改变$$\alpha$$大小，使$$\cos\alpha$$接近 0

  另外可使用磁导率很高的金属板进行磁屏蔽( 屏蔽效果与屏蔽体形状有关，板壁过厚过薄都不行，过薄没有效果，过厚会产生涡流形成反磁场，阻碍磁通进入屏蔽版)，这称为磁屏蔽。也可使用电导率很高电阻率很低的铜板或铝板，利用涡流反磁场作用的电磁屏蔽，屏蔽结构接地时，能阻断电力线的进出，兼有静电屏蔽作用，这是狭义的电磁屏蔽。狭义电磁屏蔽是将对象物体密封在屏蔽壳内，故外形颇为重要，频率较高时即使微小缝隙也会降低屏蔽效果。

- 双绞线：可缩小回路所围成的面积，且相邻两箭头所示磁道产生的感应电压极性相反，使得导线中电流产生的磁通相互抵消而对外部无影响。随着双绞线节距的减小，屏蔽效果增强

  ![image-20250412131840381](../assets/post-pics/image-20250412131840381.png)

#### 接地

广义的接地包括接实地(与大地连接)和接虚地(与电位基准点连接)。接地的目的有二：一是确定基准电位，以保证控制系统稳定可靠地运行，防止地环路引起的干扰，称为工作接地。二是避免操作人员因设备的绝缘损坏或下降遭受触电危险并保证设备的安全，称为保护接地。

在计算机控制系统中，大致有以下几种地线

- 模拟地：作为传感器、变送器、放大器、AD 和 DA 转换器中模拟电路的零电位
- 数字地：作为计算机各种数字电路的零电位，由于数字信号多为高频，模拟信号多为低频，因此数字信号一般对模拟信号是一种干扰，数字地应与模拟地分开，避免模拟信号受数字脉冲的干扰
- 信号地：传感器的地，主要是为了区别远距离传感器的弱信号地与主机的模拟地关系
- 系统地：上述几种地的最终回流点，直接与大地相连作为基准零电位
- 交流地：计算机交流供电的动力线地，又称零线，其零电位很不稳定，绝不允许与上述几种地相连，相连则会引起交流工频干扰
- 保护地：又称安全地/机壳地/屏蔽地，目的是使设备机壳与大地等电位，以避免机壳带电影响人身及设备安全

模拟地和数字地最后要连接到一起来保证共同的基准电位，但是直接相连就会产生严重的噪声干扰，实际使用时常见的隔离供地方式有：串联一个小磁珠或零欧电阻或者设置一小块铜皮连接。

认为地球的基准电位是不变的，由于接地点选取不当或接地回路设计不好，可能引起基准电位变化而引入噪声。具体来说，导致基准电位变化的原因有：

1. 接地回路中有信号电流，由于接地线路的阻抗而产生电压降，使电路基准电位发生变化。
2. 有两个以上接地点使接地回路成为环路(闭合回路)时，接地点间的电位差和对环路的电磁感应使环路中出现电流，从而发生电压降，使电路基准电位发生变化。接地回路中的环路叫做接地环路。

![image-20250412135823836](../assets/post-pics/image-20250412135823836.png)

以抑制噪声目的的电路接地技术包括：尽量减少接地回路的阻抗、使接地回路中尽量不出现电流、勿形成接地环路

接地方式包括一点接地和多点接地，设计出发点都是使接地阻抗最低。一点接地主要用于低频电路(<1MHz)，有串联方式和并联方式，并联方式没有公共阻抗，两者目的都是为防止形成地线环路

![image-20250412140338980](../assets/post-pics/image-20250412140338980.png)

多点接地主要用于高频电路(>10MHz)，频率升高时地线阻抗明显增加，采用能使接地阻抗保持最低值的接地方式

![image-20250412140938022](../assets/post-pics/image-20250412140938022.png)

#### 去耦

耦合即公共阻抗耦合，在两个电路的电流流经公共阻抗时，一个电路在该阻抗上的电压降会影响到另一个电路。以下为去耦滤波器，虚线框内为旁路电容设计

![image-20250412141407205](../assets/post-pics/image-20250412141407205.png)

按照干扰在电路的作用机理，分为共模干扰和差模干扰。共模干扰也称对地干扰，是指干扰电压同时施加在信号线路和参考地之间，以相同的方向和大小出现在两条信号线上的干扰。差模干扰又称串模干扰或常模干扰，是指干扰电压与有用信号串联叠加在信号源上，直接影响测量结果的一种干扰。

去耦的主要方式是滤波，可去除串模干扰，分为物理滤波和数字滤波。

物理滤波器从通频带上分为低通高通带通，从器件结构上分为无源滤波和有源滤波，前者结构简单但信号衰减较大，后者可提高增益并提供频率特性但线路复杂。以下为无源低通滤波器和有源低通滤波器

![image-20250412141838163](../assets/post-pics/image-20250412141838163.png)

数字滤波即在计算机中对输入信号进行处理，减小干扰在有用信号中的比重，提高信号的真实性，适用于周期性干扰，包括算术平均值/加权平均值法、中位值法(连续采样三次以上取中位数)、惯性滤波法

$$
\begin{aligned}
\overline{X}(n) &= \frac{1}{n}\sum_{i = 1}^{n} X(n - i)\\
\overline{X}(n) &= \sum_{i = 1}^{n} r_iX(n - i)\\
r_1 &> r_2 > \cdots > r_n > 0 \quad \sum_{i = 1}^{n} r_i = 1\\
\frac{Y(s)}{X(s)} &= \frac{1}{1 + T_0s}\\
y(n) &= \frac{1}{\frac{T_0}{T_S}+1}x(n)+\frac{\frac{T_0}{T_S}}{\frac{T_0}{T_S}+1}y(n - 1)\\
y(n) &= (1 - Q)y(n - 1)+Qx(n) \quad Q = \frac{1}{\frac{T_0}{T_S}+1}滤波平滑系数
\end{aligned}
$$

#### 隔离

理想的地球是电容很大的良导体，电位稳定且处处相等。实际上地球电位只是与信号电平相比相对稳定，由于地电极材料不同、接地点的地质成分和水分不同、存在低电流等原因，几乎没有任意两点完全相等的电位

共模噪声和接地环路：当电子电路(输入端有传感器和转换器等的电子电路)的接地点有两个及以上便构成接地环路

![image-20250412143001685](../assets/post-pics/image-20250412143001685.png)

---

隔离器法：信号内没有直流分量时用这种方法最简便、信号的频域宽广时不能用，有输入屏蔽和输出屏蔽，常用于工业检测领域

![image-20250412144003049](../assets/post-pics/image-20250412144003049.png)

光电隔离：光电耦合器特点如下

- 密封在一个管壳内，或采用模压塑料封装，不会受到外界光的干扰
- 靠光传送信号，切断了各部件电路之间地线的联系
- 发光二极管动态电阻非常小，而干扰源的内阻一般很大，能够传送到光电耦合器输入端的干扰信号很小
- 光电耦合器的传输比和晶体管的放大倍数相比一般很小，远不如晶体管对干扰信号那样灵敏，而光电耦合器的发光二极管只有在通过一定的电流时才能发光，从而可以有效地抑制掉干扰信号
- 光电耦合器提供了较好的带宽，较低的输入失调漂移和增益温度系数

驱动有开关驱动、OC 门驱动和晶体管驱动，发光二极管正常发光电流为几毫安

- 开关驱动：结构简单可靠；用于手动开关输入的场合
- OC 门驱动：具有较大的驱动能力；可在较高的电压下工作；可与计算机系统接口兼容
- 晶体管：具有较强的驱动能力；可用于多个光电耦合器并联；方便与计算机系统接口

![image-20250412144720308](../assets/post-pics/image-20250412144720308.png)

要保证被传送信号的变化范围始终在线性区内；且光电隔离前后两部分电路应分别采用两组互相独立的电源，以切断两部分的地线联系

![image-20250412144800975](../assets/post-pics/image-20250412144800975.png)

组合式模拟隔离器，隔离方便，信号抗干扰性强，适用于模拟信号的远距离传输

![image-20250412144924226](../assets/post-pics/image-20250412144924226.png)

---

提高共模抑制比 CMRR 的方法：差分放大器作信号前置、浮地输入双层屏蔽

CMRR 定义如下，其中$$U_{cm}$$为共模干扰电压，$$U_{n}$$为由$$U_{cm}$$转化成的常模干扰电压

$$
\begin{aligned}
\mathrm{CMRR} &= 20\lg\frac{U_{cm}}{U_n} \mathrm{(dB)}
\end{aligned}
$$

![image-20250412145346395](../assets/post-pics/image-20250412145346395.png)

### 8.4 数字信号的传输

计算机控制系统信号使用低电平信号、信号频谱宽，从直流到几百兆赫兹都有；噪声源来自带有急剧电磁变化的外来干扰和系统内部的逻辑通断(后者为系统固有的内部噪声源)

串扰噪声：以前只发生在多股复导线中，随着元器件集成度的大幅提高，PCB 的印制导线越发细密，相距很近的印制线条中流过的高速开关电流会产生串扰噪声，不容忽视。为了减少线间串扰，在使用扁平电缆传送数据信号时要使用地线将数据线间隔开

反射：信号通路长度约等于传输的信号波长，传输线的影响会使通路上的信号发生畸变，因此需要考虑传输效应

![image-20250412153211871](../assets/post-pics/image-20250412153211871.png)

反射波是直接波到达不匹配的负载阻抗引起的，这个阻抗确定了反射波的初始值，短路负载反射系数为$$-1$$，开路阻抗反射系数为$$+1$$，反射波不会比直接波大

$$
\begin{aligned}
V_R &= I_RZ_0\\
V_0 + V_R &= Z_L(I_0 - I_R)\\
V_0 &= I_0Z_0\\
\frac{V_R}{V_0} &= \frac{Z_L - Z_0}{Z_L + Z_0}
\end{aligned}
$$

![image-20250412153614649](../assets/post-pics/image-20250412153614649.png)

因此需要进行阻抗匹配，其中终端匹配的图中，上拉电阻的作用为补偿被并联电阻拉低的信号电平

![image-20250412153715222](../assets/post-pics/image-20250412153715222.png)

线的远端有多个支路的传输要求：

- 波阻抗非常高：阻止直接波吸收大量的能量
- 分支线非常短：保证传入短线的波以尽可能小的延迟重新进入传输线
- 接收器有无限大阻抗：反射所有传入短线的波，使其沿短线往回传，重新进入传输线

信号线的选择和敷设：

- 信号线的选择：精度高，干扰严重的场合应采用屏蔽信号线。信号线的截面积在 2mm2 以下为宜，一般采用 1.5mm2 和 1.0mm2 两种。采用多股线电缆较好，适宜于电缆沟有拐角和狭窄的地方。
- 信号线的敷设：模拟信号线与数字信号线不能合用同一股电缆，绝对避免信号线与电源线合用同一股电缆。屏蔽信号线的屏蔽层要单端接地，避免多点接地。 信号线的敷设要尽量远离干扰源，比如避免敷设在大容量变压器，电动机等电器设备的附近。信号电缆与电源电缆必须分开，并尽量避免平行敷设。

### 8.5 电源系统的抗干扰措施

![image-20250412154145983](../assets/post-pics/image-20250412154145983.png)
