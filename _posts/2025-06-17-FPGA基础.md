---
title: FPGA基础
description: 知识储备
author: Hatrix
date: 2025-06-17 17:57:00 +0800
categories: [硬件开发]
tags: [实践技能]
math: true
mermaid: true
pin: false
image:
  path: https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250619232205240.png
  alt: Booth-NeRF Overview
---

## 可编程逻辑设备发展史

可编程逻辑设备，简称 CLD(Configurable Logic Device)，即可通过编程配置逻辑功能的设备，是 FPGA 的上级概念。早期的 CLD 设备包括 PROM、PLA、PAL 等。

由于组合逻辑函数都可用真值表来表示，故 PROM 是天然的 CLD。通过施加电压熔断保险丝的方式控制连接矩阵中每个节点的通断，这里的图中就是用 PROM 的一列存储了一个真值表。PLA(Programmable Logic Array)是早期专为硬件编程设计的器件，仍然用保险丝实现编程。将逻辑函数写成 SOP(Sum of Product)形式，就可以用 PLA 实现。PAL 在 PLA 的基础上，固定了或门，只允许与门的编程，同时加入了一些时序逻辑的电路，牺牲了逻辑函数实现的密度，简化了结构，降低了成本。

<img src="https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250619230921304.png" style="zoom: 67%;" />

1984 年，赛灵思发明了第一块 FPGA 芯片 XC2064，将 IO 移到边上，把芯片做成 CLB 矩阵的形式，使得任意两个 CLB 可通过中间的 Programmable Interconnect 相连，解决了 PAL 这种内部晶体管增长速度远大于与或门连接部分的针脚增长速度

，导致随着芯片规模增大，内部延迟增加的问题。

<img src="https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250619231108840.png" style="zoom: 50%;" />

CLB 是 FPGA 的编程部分，其中包含查找表 LUT(Lookup Table)和触发器 FF(Flip-Flops)。LUT 是存储真值表的介质，通过 SRAM 实现编程，可以反复编程且不用刷新电子，

<img src="https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250619231431328.png" style="zoom: 50%;" />

<img src="https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250619231156050.png" style="zoom:50%;" />

## 关于 FPGA

FPGA 中由软件来优化资源，即用最少的 CLB 实现逻辑函数。LUT 还可用作分布式 RAM，作为快速高效的 on-chip memory。FPGA 里面所有东西基本都可以自由配置，比如 IO 可配置来适配不同的协议。此外 FPGA 还拥有很高的并行度，由于任意的 CLB 通过中间的 Programmable Interconnect 相连，这意味着可以在一块芯片里只对部分的 CLB 编程，因此一块芯片可以同时执行不同的功能，或者以流水线的形式在不同时刻对数据做不同的处理。FPGA 的工作方式与 GPU 类似，也是以加速卡的形式通过 PCIE 直接和 CPU 连接，把一些本该在 CPU 上由软件执行的工作 offload 到硬件电路上进行。用 FPGA 进行视频处理，通过这个 pipeline，可以对视频流作任何形式的处理，延迟也会非常地可控。

### 基本结构

FPGA 基本结构一般由五部分组成，分别为可编程输入/输出单元、基本可编程逻辑单元、嵌入式块 RAM、布线资源和 IP 硬核单元，如下图所示：

<img src="https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250619231220594.png" style="zoom: 67%;" />

### 开发流程

FPGA 开发流程包括：设计 Design(模块和测试)、分析和综合 Synthesis(编译 Compiling)、功能仿真 Simulation、性能分析 Analysis、布局布线 Implementation、生成比特流和板级调试。

设计阶段需要用硬件描述语言编写功能模块以及相应的测试方案，对于 FIFO、RAM、ROM 等常用的功能，有现成的轮子，即 IP 核(Intellectual Property)可以使用；分析和综合即使用专业 EDA(如 Vivado、Quartus、ISE 等)中的工具，对逻辑描述内容进行分析并得到逻辑门级别的电路；功能仿真即用于验证功能；布局布线即分配引脚(layout--> IO panning)确定内部电路连接关系；分析性能有时序仿真、静态时序分析两种方式，主要是看延迟时间是否在允许范围内；最后将生成的比特流下载到目标板上进行板级调试。

## ZYNQ

ZYNQ 是 Xilinx 推出的一系列片上系统(SoC)型 FPGA 产品，它将传统 FPGA 的可编程逻辑(PL)与 ARM 处理器核心(PS)深度集成，形成独特的异构计算架构。通过 AXI(Advanced eXtensible Interface)总线实现 PS 与 PL 间的低延迟数据传输，这也是 Zynq 上主要的数据通信机制。所有的 Zynq-7000 芯片具有相同的架构，以 ARM 处理器系统为基础，与 Microbraze 这样的软核处理器不同，它是一颗专用的硬核处理器，不占用 FPGA 的逻辑资源，并且比 Microbraze 有更高的性能。

PS 具有固定的架构，包含了处理器和系统的存储器；而 PL 完全是灵活的，给了设计者一块“空白画布”来创建定制的外设。在 ZYNQ 上，PS 端为 ARM-Cortex A9 内核。ARM Cortex-A9 是一个应用级的处理器，能运行像 Linux 这样的操作系统，而可编程逻辑是基于 Xilinx 7 系列的 FPGA 架构。ZYNQ 架构实现了工业标准的 AXI 接口，在芯片的两个部分之间实现了高带宽、低延迟的连接。PS 和 PL 端的协同设计是 Zynq 嵌入式系统设计的重要部分，PL 适合并行流处理，而 PS 适合控制或具有串行执行特性的部分以及浮点计算等。

<img src="https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250619231506339.png" style="zoom:50%;" />

<img src="https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250619231520951.png" style="zoom: 50%;" />

另外，Zynq 处理器系统并非只有 ARM 处理器，除了一个应用处理器单元(APU)，还有拓展外设接口、cache 存储器、存储器接口、互联接口和时钟发生电路等。

<img src="https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250619231537943.png" style="zoom: 67%;" />

ZYNQ 命名规则：以 ZYNQ“XC7Z020-CLG400-2”为例，“XC”是“Xilinx 公司”；“7”是 7 系列(Series)；“Z”是型号是 zynq；“020”是价值索引(Value Index)，该数值越大对应芯片内部资源越丰富，价值越高；“clg400”芯片封装信息，“CLG”是芯片制造工艺信息，“400”是芯片封装引脚计数(Package Pin Count)；“-2”是速度等级(Speed Grade)；“-I”是温度等级(Temperature Grade)，温度等级有三种标准，分别是“C”、“E”与“I”。

### 设计流程

<img src="https://cdn.jsdelivr.net/gh/SparkyXXX/Hatrix-s-Blog-Image/img/20250619231551189.png" style="zoom: 50%;" />

Verilog 的设计流程，一般包括以下几个步骤：

**需求分析**

工作人员需要对用户提出的功能要求进行分析理解，做出电路系统的整体规划，形成详细的技术指标，确定初步方案。例如，要设计一个电子屏，需要考虑供电方式、工作频率、产品体积、成本、功耗等，电路实现采用 ASIC 还是选用 FPGA/CPLD 器件等。

**功能划分**

正确地分析了用户的电路需求后，就可以进行逻辑功能的总体设计，设计整个电路的功能、接口和总体结构，考虑功能模块的划分和设计思路，各子模块的接口和时序(包括接口时序和内部信号的时序)等，向项目组成员合理分配子模块设计任务。

**文本描述**

可以用任意的文本编辑器，也可以用专用的 HDL 编辑环境，对所需求的数字电路进行设计建模，保存为 **.v** 文件。

**功能仿真(前仿真)**

对建模文件进行编译，对模型电路进行功能上的仿真验证，查找设计的错误并修正。

此时的仿真验证并没有考虑到信号的延迟等一些 timing 因素，只是验证逻辑上的正确性。

**逻辑综合**

综合(synthesize)，就是在标准单元库和特定的设计约束的基础上，将设计的高层次描述(Verilog 建模)转换为门级网表的过程。逻辑综合的目的是产生物理电路门级结构，并在逻辑、时序上进行一定程度的优化，寻求逻辑、面积、功耗的平衡，增强电路的可测试性。

但不是所有的 Verilog 语句都是可以综合成逻辑单元的，例如时延语句。

**布局布线**

根据逻辑综合出的网表与约束文件，利用厂家提供的各种基本标准单元库，对门级电路进行布局布线。至此，已经将 Verilog 设计的数字电路，设计成由标准单元库组成的数字电路。

**时序仿真(后仿真)**

布局布线后，电路模型中已经包含了时延信息。利用在布局布线中获得的精确参数，用仿真软件验证电路的时序。单元器件的不同、布局布线方案都会给电路的时序造成影响，严重时会出现错误。出错后可能就需要重新修改 RTL(寄存器传输级描述，即 Verilog 初版描述)，重复后面的步骤。这样的过程可能反复多次，直至错误完全排除。

**FPGA/CPLD 下载或 ASIC 制造工艺生产**

完成上面所有步骤后，就可以通过开发工具将设计的数字电路目标文件下载到 FPGA/CPLD 芯片中，然后在电路板上进行调试、验证。

如果要在 ASIC 上实现，则需要制造芯片。一般芯片制造时，也需要先在 FPGA 板卡上进行逻辑功能的验证。

## Xilinx FPGA 入门视频

### 学习内容

Verilog 语法、FPGA 常见设计方法、状态机、线性序列机、常见的通讯驱动和接口设计

### 两选一多路器 Mux2 实践

run implementation：实现设计综合网表(布局布线)

run behavioral simulation：功能仿真

`timescale 1ns/1ns 两个 1ns 分别代表时间单位和时间精度

例化：将模块的端口和测试平台上的接线连接起来

#是仿真延时，不会生成对应的电路，主要是仿真的时候写激励用

tb：test_bench 测试平台

写好的是模块，需要例化，放在测试平台上，给激励信号观察输出结果

open syntehsized design 之后才可以看到 device 图，才可以进行引脚分配

reg 和 wire

RTL(寄存器传输级描述，即 Verilog 初版描述

### 三八译码器实现

```Verilog
output reg [7:0] out; // 定义一个八位的、输出方向的、寄存器类型的数据
assign d = {a, 1'b0, b, c}; //{}进行位拼接，此处d为四位。1'b0中的b是描述多位宽信号的格式限定符，其它的还有o、d、h，分别为八、十、十六进制；进制在Verilog中可以混杂使用，各进制之间完全等效
always@(*)
```

以 always 块描述的信号赋值，被赋值对象必须定义为 reg

## 参考资料

[ZYNQ 架构介绍](https://zhuanlan.zhihu.com/p/646645247)

[Zynq Soc 介绍](https://fpga.eetrend.com/content/2022/100567012.html)

[FPGA 和硬件加速](https://www.bilibili.com/video/BV1xo4y1c7AD/?vd_source=1d0891b41fe4e23dbf197eaf61dfa468)

[Verilog 语法](https://www.runoob.com/w3cnote/Verilog-install.html)

[wire 和 reg 区别](https://www.cnblogs.com/SYoong/articles/5848601.html)

[几种赋值语句](https://fpga.eetrend.com/content/2019/100045217.html)
